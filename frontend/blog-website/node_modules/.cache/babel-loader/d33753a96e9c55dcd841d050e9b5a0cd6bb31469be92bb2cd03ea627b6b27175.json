{"ast":null,"code":"'use strict';\n\nObject.defineProperty(exports, '__esModule', {\n  value: true\n});\nfunction _interopDefault(ex) {\n  return ex && typeof ex === 'object' && 'default' in ex ? ex['default'] : ex;\n}\nvar _flatten = _interopDefault(require('szfe-tools/lib/flatten'));\nvar _get = _interopDefault(require('szfe-tools/lib/get'));\nvar _run = _interopDefault(require('szfe-tools/lib/run'));\nvar _debounce = _interopDefault(require('szfe-tools/lib/debounce'));\nvar React = require('react');\nvar React__default = _interopDefault(React);\nvar _isFunction = _interopDefault(require('szfe-tools/lib/isFunction'));\nvar createContext$1 = _interopDefault(require('create-react-context'));\nvar _EventBus = _interopDefault(require('szfe-tools/lib/EventBus'));\nvar _nextTick = _interopDefault(require('szfe-tools/lib/nextTick'));\nvar reactDom = require('react-dom');\nvar _isString = _interopDefault(require('szfe-tools/lib/isString'));\nvar _isExist = _interopDefault(require('szfe-tools/lib/isExist'));\nvar _memoize = _interopDefault(require('szfe-tools/lib/memoize'));\nvar _isUndefined = _interopDefault(require('szfe-tools/lib/isUndefined'));\nvar _isObject = _interopDefault(require('szfe-tools/lib/isObject'));\nvar hoistStatics = _interopDefault(require('hoist-non-react-statics'));\nvar _value = _interopDefault(require('szfe-tools/lib/value'));\nvar _isArray = _interopDefault(require('szfe-tools/lib/isArray'));\nvar _globalThis = _interopDefault(require('szfe-tools/lib/globalThis'));\nvar NodeKey = _interopDefault(require('react-node-key'));\nfunction _iterableToArrayLimit(arr, i) {\n  var _i = null == arr ? null : \"undefined\" != typeof Symbol && arr[Symbol.iterator] || arr[\"@@iterator\"];\n  if (null != _i) {\n    var _s,\n      _e,\n      _x,\n      _r,\n      _arr = [],\n      _n = !0,\n      _d = !1;\n    try {\n      if (_x = (_i = _i.call(arr)).next, 0 === i) {\n        if (Object(_i) !== _i) return;\n        _n = !1;\n      } else for (; !(_n = (_s = _x.call(_i)).done) && (_arr.push(_s.value), _arr.length !== i); _n = !0);\n    } catch (err) {\n      _d = !0, _e = err;\n    } finally {\n      try {\n        if (!_n && null != _i.return && (_r = _i.return(), Object(_r) !== _r)) return;\n      } finally {\n        if (_d) throw _e;\n      }\n    }\n    return _arr;\n  }\n}\nfunction ownKeys(object, enumerableOnly) {\n  var keys = Object.keys(object);\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n    enumerableOnly && (symbols = symbols.filter(function (sym) {\n      return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n    })), keys.push.apply(keys, symbols);\n  }\n  return keys;\n}\nfunction _objectSpread2(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = null != arguments[i] ? arguments[i] : {};\n    i % 2 ? ownKeys(Object(source), !0).forEach(function (key) {\n      _defineProperty(target, key, source[key]);\n    }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) {\n      Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n    });\n  }\n  return target;\n}\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\nfunction _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, _toPropertyKey(descriptor.key), descriptor);\n  }\n}\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  Object.defineProperty(Constructor, \"prototype\", {\n    writable: false\n  });\n  return Constructor;\n}\nfunction _defineProperty(obj, key, value) {\n  key = _toPropertyKey(key);\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n  return obj;\n}\nfunction _extends() {\n  _extends = Object.assign ? Object.assign.bind() : function (target) {\n    for (var i = 1; i < arguments.length; i++) {\n      var source = arguments[i];\n      for (var key in source) {\n        if (Object.prototype.hasOwnProperty.call(source, key)) {\n          target[key] = source[key];\n        }\n      }\n    }\n    return target;\n  };\n  return _extends.apply(this, arguments);\n}\nfunction _inherits(subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function\");\n  }\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      writable: true,\n      configurable: true\n    }\n  });\n  Object.defineProperty(subClass, \"prototype\", {\n    writable: false\n  });\n  if (superClass) _setPrototypeOf(subClass, superClass);\n}\nfunction _getPrototypeOf(o) {\n  _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function _getPrototypeOf(o) {\n    return o.__proto__ || Object.getPrototypeOf(o);\n  };\n  return _getPrototypeOf(o);\n}\nfunction _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n  return _setPrototypeOf(o, p);\n}\nfunction _isNativeReflectConstruct() {\n  if (typeof Reflect === \"undefined\" || !Reflect.construct) return false;\n  if (Reflect.construct.sham) return false;\n  if (typeof Proxy === \"function\") return true;\n  try {\n    Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));\n    return true;\n  } catch (e) {\n    return false;\n  }\n}\nfunction _objectWithoutPropertiesLoose(source, excluded) {\n  if (source == null) return {};\n  var target = {};\n  var sourceKeys = Object.keys(source);\n  var key, i;\n  for (i = 0; i < sourceKeys.length; i++) {\n    key = sourceKeys[i];\n    if (excluded.indexOf(key) >= 0) continue;\n    target[key] = source[key];\n  }\n  return target;\n}\nfunction _objectWithoutProperties(source, excluded) {\n  if (source == null) return {};\n  var target = _objectWithoutPropertiesLoose(source, excluded);\n  var key, i;\n  if (Object.getOwnPropertySymbols) {\n    var sourceSymbolKeys = Object.getOwnPropertySymbols(source);\n    for (i = 0; i < sourceSymbolKeys.length; i++) {\n      key = sourceSymbolKeys[i];\n      if (excluded.indexOf(key) >= 0) continue;\n      if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue;\n      target[key] = source[key];\n    }\n  }\n  return target;\n}\nfunction _assertThisInitialized(self) {\n  if (self === void 0) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n  return self;\n}\nfunction _possibleConstructorReturn(self, call) {\n  if (call && (typeof call === \"object\" || typeof call === \"function\")) {\n    return call;\n  } else if (call !== void 0) {\n    throw new TypeError(\"Derived constructors may only return object or undefined\");\n  }\n  return _assertThisInitialized(self);\n}\nfunction _createSuper(Derived) {\n  var hasNativeReflectConstruct = _isNativeReflectConstruct();\n  return function _createSuperInternal() {\n    var Super = _getPrototypeOf(Derived),\n      result;\n    if (hasNativeReflectConstruct) {\n      var NewTarget = _getPrototypeOf(this).constructor;\n      result = Reflect.construct(Super, arguments, NewTarget);\n    } else {\n      result = Super.apply(this, arguments);\n    }\n    return _possibleConstructorReturn(this, result);\n  };\n}\nfunction _slicedToArray(arr, i) {\n  return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest();\n}\nfunction _toArray(arr) {\n  return _arrayWithHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableRest();\n}\nfunction _toConsumableArray(arr) {\n  return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableSpread();\n}\nfunction _arrayWithoutHoles(arr) {\n  if (Array.isArray(arr)) return _arrayLikeToArray(arr);\n}\nfunction _arrayWithHoles(arr) {\n  if (Array.isArray(arr)) return arr;\n}\nfunction _iterableToArray(iter) {\n  if (typeof Symbol !== \"undefined\" && iter[Symbol.iterator] != null || iter[\"@@iterator\"] != null) return Array.from(iter);\n}\nfunction _unsupportedIterableToArray(o, minLen) {\n  if (!o) return;\n  if (typeof o === \"string\") return _arrayLikeToArray(o, minLen);\n  var n = Object.prototype.toString.call(o).slice(8, -1);\n  if (n === \"Object\" && o.constructor) n = o.constructor.name;\n  if (n === \"Map\" || n === \"Set\") return Array.from(o);\n  if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen);\n}\nfunction _arrayLikeToArray(arr, len) {\n  if (len == null || len > arr.length) len = arr.length;\n  for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];\n  return arr2;\n}\nfunction _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\nfunction _nonIterableRest() {\n  throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\nfunction _toPrimitive(input, hint) {\n  if (typeof input !== \"object\" || input === null) return input;\n  var prim = input[Symbol.toPrimitive];\n  if (prim !== undefined) {\n    var res = prim.call(input, hint || \"default\");\n    if (typeof res !== \"object\") return res;\n    throw new TypeError(\"@@toPrimitive must return a primitive value.\");\n  }\n  return (hint === \"string\" ? String : Number)(input);\n}\nfunction _toPropertyKey(arg) {\n  var key = _toPrimitive(arg, \"string\");\n  return typeof key === \"symbol\" ? key : String(key);\n}\n\n// 值类型判断 +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++\nvar isRegExp = function isRegExp(val) {\n  return val instanceof RegExp;\n};\n// 值类型判断 -------------------------------------------------------------\n\nvar aliveScopeContext = createContext$1();\nvar AliveScopeProvider = aliveScopeContext.Provider,\n  AliveScopeConsumer = aliveScopeContext.Consumer;\nvar aliveNodeContext = createContext$1();\nvar AliveNodeProvider = aliveNodeContext.Provider,\n  AliveNodeConsumer = aliveNodeContext.Consumer;\nvar eventBus = new _EventBus();\nvar FakeScopeProvider = /*#__PURE__*/function (_Component) {\n  _inherits(FakeScopeProvider, _Component);\n  var _super = _createSuper(FakeScopeProvider);\n  function FakeScopeProvider(props) {\n    var _this;\n    _classCallCheck(this, FakeScopeProvider);\n    _this = _super.call(this, props);\n    FakeScopeProvider.currentContextValue = props.value;\n    return _this;\n  }\n  _createClass(FakeScopeProvider, [{\n    key: \"shouldComponentUpdate\",\n    value: function shouldComponentUpdate(nextProps) {\n      if (nextProps.value !== this.props.value) {\n        FakeScopeProvider.currentContextValue = nextProps.value;\n        eventBus.emit('update', nextProps.value);\n      }\n      return nextProps.children !== this.props.children || nextProps.value !== this.props.value;\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var children = this.props.children;\n      return children;\n    }\n  }]);\n  return FakeScopeProvider;\n}(React.Component);\n_defineProperty(FakeScopeProvider, \"eventBus\", eventBus);\n_defineProperty(FakeScopeProvider, \"currentContextValue\", undefined);\nvar FakeScopeConsumer = /*#__PURE__*/function (_PureComponent) {\n  _inherits(FakeScopeConsumer, _PureComponent);\n  var _super2 = _createSuper(FakeScopeConsumer);\n  function FakeScopeConsumer(props) {\n    var _this2;\n    _classCallCheck(this, FakeScopeConsumer);\n    _this2 = _super2.call(this, props);\n    _defineProperty(_assertThisInitialized(_this2), \"state\", {\n      context: FakeScopeProvider.currentContextValue\n    });\n    _defineProperty(_assertThisInitialized(_this2), \"updateListener\", _debounce(function (nextContextValue) {\n      _this2.setState({\n        context: nextContextValue\n      });\n    }));\n    eventBus.on('update', _this2.updateListener);\n    return _this2;\n  }\n  _createClass(FakeScopeConsumer, [{\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      eventBus.off('update', this.updateListener);\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var children = this.props.children;\n      var context = this.state.context;\n      return _run(children, undefined, context);\n    }\n  }]);\n  return FakeScopeConsumer;\n}(React.PureComponent);\nvar _excluded = [\"children\"];\nvar _filehash = \"qj9A\";\nvar useScopeContext = function useScopeContext() {\n  if (!_isFunction(React.useContext)) {\n    return {};\n  }\n  var scopeReactContext = React.useContext(aliveScopeContext);\n  if (scopeReactContext) {\n    return scopeReactContext;\n  }\n  var _useState = React.useState(FakeScopeProvider.currentContextValue),\n    _useState2 = _slicedToArray(_useState, 2),\n    context = _useState2[0],\n    setContext = _useState2[1];\n  React.useEffect(function () {\n    var updateListener = _debounce(setContext);\n    eventBus.on('update', updateListener);\n    return function () {\n      return eventBus.off('update', updateListener);\n    };\n  }, []);\n  return context;\n};\nvar AliveScopeProvider$1 = function AliveScopeProvider$1(_ref) {\n  var children = _ref.children,\n    props = _objectWithoutProperties(_ref, _excluded);\n  return /*#__PURE__*/React__default.createElement(AliveScopeProvider, _extends({}, props, {\n    _nk: \"\".concat(_filehash, \"11\")\n  }), /*#__PURE__*/React__default.createElement(FakeScopeProvider, _extends({}, props, {\n    _nk: \"\".concat(_filehash, \"21\")\n  }), children));\n};\nvar AliveScopeConsumer$1 = function AliveScopeConsumer$1(_ref2) {\n  var children = _ref2.children;\n  return /*#__PURE__*/React__default.createElement(AliveScopeConsumer, {\n    _nk: \"\".concat(_filehash, \"31\")\n  }, function (reactContext) {\n    return !!reactContext ? _run(children, undefined, reactContext) : /*#__PURE__*/React__default.createElement(FakeScopeConsumer, {\n      _nk: \"\".concat(_filehash, \"41\")\n    }, children);\n  });\n};\n\n// function Suspender({ freeze, children }) {\n//   const promiseCache = useRef({}).current\n//   if (freeze && !promiseCache.promise) {\n//     promiseCache.promise = new Promise((resolve) => {\n//       promiseCache.resolve = resolve\n//     })\n//     throw promiseCache.promise\n//   } else if (freeze) {\n//     throw promiseCache.promise\n//   } else if (promiseCache.promise) {\n//     promiseCache.resolve()\n//     promiseCache.promise = undefined\n//   }\n\n//   return <Fragment>{children}</Fragment>\n// }\nvar _filehash$1 = \"Leb+\";\nvar Suspender = /*#__PURE__*/function (_Component) {\n  _inherits(Suspender, _Component);\n  var _super = _createSuper(Suspender);\n  function Suspender() {\n    var _this;\n    _classCallCheck(this, Suspender);\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n    _this = _super.call.apply(_super, [this].concat(args));\n    _defineProperty(_assertThisInitialized(_this), \"promiseCache\", {});\n    return _this;\n  }\n  _createClass(Suspender, [{\n    key: \"render\",\n    value: function render() {\n      var _this$props = this.props,\n        freeze = _this$props.freeze,\n        children = _this$props.children;\n      var promiseCache = this.promiseCache;\n      if (freeze && !promiseCache.promise) {\n        promiseCache.promise = new Promise(function (resolve) {\n          promiseCache.resolve = resolve;\n        });\n        throw promiseCache.promise;\n      } else if (freeze) {\n        throw promiseCache.promise;\n      } else if (promiseCache.promise) {\n        promiseCache.resolve();\n        promiseCache.promise = undefined;\n      }\n      return /*#__PURE__*/React__default.createElement(React.Fragment, null, children);\n    }\n  }]);\n  return Suspender;\n}(React.Component);\nfunction Freeze(_ref) {\n  var freeze = _ref.freeze,\n    children = _ref.children,\n    _ref$placeholder = _ref.placeholder,\n    placeholder = _ref$placeholder === void 0 ? null : _ref$placeholder;\n  return /*#__PURE__*/React__default.createElement(React.Suspense, {\n    fallback: placeholder,\n    _nk: \"\".concat(_filehash$1, \"11\")\n  }, /*#__PURE__*/React__default.createElement(Suspender, {\n    freeze: freeze,\n    _nk: \"\".concat(_filehash$1, \"21\")\n  }, children));\n}\nvar fixedContext = [];\nvar updateListenerCache = new Map();\nvar eventBus$1 = new _EventBus();\nvar fixContext = _memoize(function (ctx) {\n  if (!_isExist(ctx)) {\n    return;\n  }\n\n  // 排除 KeepAlive 功能的上下文\n  if ([aliveScopeContext, aliveNodeContext].includes(ctx)) {\n    return;\n  }\n\n  // #259: 结合 use-context-selector 时，修复被删除的 Consumer\n  if (!_isExist(ctx.Consumer)) {\n    var Consumer = function Consumer(_ref) {\n      var children = _ref.children;\n      var ctxValue = _run(React.useContext, undefined, ctx);\n      return /*#__PURE__*/React__default.createElement(React.Fragment, null, _run(children, undefined, ctxValue));\n    }; // 重新声明 Consumer\n    ctx.Consumer = Consumer;\n  }\n  fixedContext.push(ctx);\n  setTimeout(function () {\n    return eventBus$1.emit('update');\n  });\n});\nvar createContext = function createContext(defaultValue, calculateChangedBits) {\n  var ctx = createContext$1(defaultValue, calculateChangedBits);\n  fixContext(ctx);\n  return ctx;\n};\nvar tryFixCtx = _memoize(function (type) {\n  // 尝试读取 Provider 或 Consumer 中的 context 静态属性\n  var ctx = _get(type, '_context') || _get(type, 'context'); // 16.3.0 版本为 context，之后为 _context\n\n  // 判断是否为 ReactContext 类型\n  if (_get(ctx, '$$typeof') === _get(aliveScopeContext, '$$typeof')) {\n    fixContext(ctx);\n  }\n});\nvar override = function override(configs) {\n  configs.forEach(function (_ref2) {\n    var _ref3 = _toArray(_ref2),\n      host = _ref3[0],\n      methods = _ref3.slice(1);\n    methods.forEach(function (method) {\n      if (!_isFunction(_get(host, method)) || _get(host, [method, '_overridden'])) {\n        return;\n      }\n      var originMethod = host[method].bind(host);\n      host[method] = function (type) {\n        if (!_isString(type)) {\n          tryFixCtx(type);\n        }\n        for (var _len = arguments.length, args = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n          args[_key - 1] = arguments[_key];\n        }\n        return originMethod.apply(void 0, [type].concat(args));\n      };\n      host[method]._overridden = true;\n    });\n  });\n};\n\n/**\n * 通过覆写 React.createElement 方法来探测 Provider 或 Consumer 的创建，并攫取其中 context 主动进行修复\n * TODO：同时兼容 React 17+，目前仅默认兼容 React.createElement 方法\n * React 17+ 为 require('react/jsx-runtime') 或 require('react/jsx-dev-runtime') 的 jsx、jsxs、jsxDEV 方法\n * 但由于无法动态 require，暂未想到方式同时兼容\n * 若需兼容 17+，目前手法为\n *\n * autoFixContext(\n *   [require('react/jsx-runtime'), 'jsx', 'jsxs', 'jsxDEV'],\n *   [require('react/jsx-dev-runtime'), 'jsx', 'jsxs', 'jsxDEV']\n * )\n *\n * Note: 需注意 16.2.x 及以下版本不支持此方法\n */\nvar autoFixContext = function autoFixContext() {\n  try {\n    for (var _len2 = arguments.length, configs = new Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {\n      configs[_key2] = arguments[_key2];\n    }\n    override(configs);\n  } catch (err) {\n    console.warn('activation override failed:', err);\n  }\n};\nautoFixContext([React__default, 'createElement']);\nvar _filehash$2 = \"lqEk\";\nvar ProviderBridge = /*#__PURE__*/function (_PureComponent) {\n  _inherits(ProviderBridge, _PureComponent);\n  var _super = _createSuper(ProviderBridge);\n  function ProviderBridge(props) {\n    var _this;\n    _classCallCheck(this, ProviderBridge);\n    _this = _super.call(this, props);\n    _defineProperty(_assertThisInitialized(_this), \"unmount\", null);\n    var ctxValues = props.value;\n    if (ctxValues.length === 0) {\n      _this.state = {\n        ctxValue: null\n      };\n      return _possibleConstructorReturn(_this);\n    }\n    var _ctxValues = _slicedToArray(ctxValues, 1),\n      _ctxValues$ = _ctxValues[0],\n      ctx = _ctxValues$.ctx,\n      value = _ctxValues$.value,\n      onUpdate = _ctxValues$.onUpdate;\n    _this.state = {\n      ctxValue: value\n    };\n    _this.unmount = onUpdate(function (value) {\n      _this.setState({\n        ctxValue: value\n      });\n    });\n    return _this;\n  }\n  _createClass(ProviderBridge, [{\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      _run(this.unmount);\n    }\n\n    // componentDidCatch(error) {\n    //   console.error('ProviderBridge Error', error)\n    // }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this$props = this.props,\n        propCtxValues = _this$props.value,\n        children = _this$props.children;\n      var ctxValues = propCtxValues.filter(Boolean);\n      if (ctxValues.length === 0) {\n        return children;\n      }\n      var ctxValue = this.state.ctxValue;\n      var _ctxValues2 = _toArray(ctxValues),\n        ctx = _ctxValues2[0].ctx,\n        restValues = _ctxValues2.slice(1);\n      var Provider = ctx.Provider;\n      var nextChildren = !_isUndefined(ctxValue) ? /*#__PURE__*/React__default.createElement(Provider, {\n        value: ctxValue,\n        _nk: \"\".concat(_filehash$2, \"11\")\n      }, children) : children;\n\n      // 递归 ProviderBridge 修复多个上下文\n      // 此处未考虑待修复上下文顺序问题，按先来后到顺序处理，但理论上不应存在顺序问题\n      return restValues.length > 0 ? /*#__PURE__*/React__default.createElement(ProviderBridge, {\n        value: restValues,\n        _nk: \"\".concat(_filehash$2, \"21\")\n      }, nextChildren) : nextChildren;\n    }\n  }]);\n  return ProviderBridge;\n}(React.PureComponent);\nvar ConsumerWrapper = /*#__PURE__*/function (_Component) {\n  _inherits(ConsumerWrapper, _Component);\n  var _super = _createSuper(ConsumerWrapper);\n  function ConsumerWrapper(props) {\n    var _this;\n    _classCallCheck(this, ConsumerWrapper);\n    _this = _super.call(this, props);\n    _defineProperty(_assertThisInitialized(_this), \"updateListener\", null);\n    _defineProperty(_assertThisInitialized(_this), \"ctxInfo\", null);\n    var value = props.value,\n      ctx = props.ctx,\n      id = props.id;\n    if (_isUndefined(value)) {\n      return _possibleConstructorReturn(_this);\n    }\n\n    // 因 Consumer 探测器存在于 KeepAlive 外层故会随着 KeepAlive 卸载\n    // componentWillUnmount 中保留了已生成的更新监听器\n    // 此处重新挂载后恢复与对应 Keeper 中 ProviderBridge 的联系\n    _this.updateListener = _get(updateListenerCache.get(ctx), id, new Map());\n    _run(_this.updateListener, 'forEach', function (fn) {\n      return fn(value);\n    });\n    _this.ctxInfo = {\n      ctx: ctx,\n      value: value,\n      // 注册上下文更新的监听，保证上下文更新时 Keeper 中 ProviderBridge 内容的同步\n      onUpdate: function onUpdate(updator) {\n        _this.updateListener.set(updator, updator);\n\n        // 返回更新监听器的注销方法\n        return function () {\n          return _this.updateListener[\"delete\"](updator);\n        };\n      }\n    };\n    return _this;\n  }\n  _createClass(ConsumerWrapper, [{\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      var _this$props = this.props,\n        value = _this$props.value,\n        ctx = _this$props.ctx,\n        id = _this$props.id;\n      if (_isUndefined(value)) {\n        return;\n      }\n\n      // 因 Consumer 探测器存在于 KeepAlive 外层故会随着 KeepAlive 卸载\n      // 此处保留其中已生成的更新监听器，用以在重新挂载后保持与对应 Keeper 中 ProviderBridge 的联系\n      updateListenerCache.set(ctx, _objectSpread2(_objectSpread2({}, _get(updateListenerCache.get(ctx), undefined, {})), {}, _defineProperty({}, id, this.updateListener)));\n    }\n\n    // 利用 shouldComponentUpdate 尽早将上下文更新的咨询通知到对应 Keeper 中 ProviderBridge\n    // TODO: 改用 componentWillReceiveProps 更早地进行更新，需注意与 getDerivedStateFromProps 新生命周期的兼容及可能存在的死循环问题\n  }, {\n    key: \"shouldComponentUpdate\",\n    value: function shouldComponentUpdate(_ref) {\n      var value = _ref.value;\n      var prevValue = this.props.value;\n      var shouldUpdate = prevValue !== value;\n      if (shouldUpdate) {\n        _run(this.updateListener, 'forEach', function (fn) {\n          return fn(value);\n        });\n      }\n      return true;\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n      var _this$props2 = this.props,\n        value = _this$props2.value,\n        renderWrapper = _this$props2.renderWrapper,\n        renderContent = _this$props2.renderContent,\n        id = _this$props2.id;\n      return renderWrapper(function (ctx$$) {\n        return renderContent(_isUndefined(value) ? ctx$$ : [].concat(_toConsumableArray(ctx$$), [_this2.ctxInfo]));\n      });\n    }\n  }]);\n  return ConsumerWrapper;\n}(React.Component);\nvar _filehash$3 = \"SsUr\";\nvar fixedContextSnapshot = {};\n\n// 对 ConsumerWrapper 的递归结构，会在 devtool 中生成较深的嵌套结构，可用 hooks 消除嵌套结构\nvar RecursiveConsumerBridge = /*#__PURE__*/function (_PureComponent) {\n  _inherits(RecursiveConsumerBridge, _PureComponent);\n  var _super = _createSuper(RecursiveConsumerBridge);\n  function RecursiveConsumerBridge(props) {\n    var _this;\n    _classCallCheck(this, RecursiveConsumerBridge);\n    _this = _super.call(this, props);\n    _defineProperty(_assertThisInitialized(_this), \"renderWrapper\", function (renderChildren) {\n      var id = _this.props.id;\n      var renderWrapper = fixedContextSnapshot[id].reduce(function (render, ctx) {\n        var Consumer = ctx.Consumer;\n        var renderWrapper = function renderWrapper(renderContent) {\n          return /*#__PURE__*/React__default.createElement(Consumer, {\n            _nk: \"\".concat(_filehash$3, \"11\")\n          }, function (value) {\n            return /*#__PURE__*/React__default.createElement(ConsumerWrapper, {\n              value: value,\n              ctx: ctx,\n              renderWrapper: render,\n              renderContent: renderContent,\n              id: id,\n              _nk: \"\".concat(_filehash$3, \"21\")\n            });\n          });\n        };\n        return renderWrapper;\n      }, function (renderContent) {\n        return renderContent([]);\n      });\n      return renderWrapper(renderChildren);\n    });\n    var _id = props.id;\n    if (!fixedContextSnapshot[_id]) {\n      fixedContextSnapshot[_id] = _toConsumableArray(fixedContext).filter(function (ctx) {\n        return _isExist(ctx.Consumer);\n      });\n    }\n    return _this;\n  }\n  _createClass(RecursiveConsumerBridge, [{\n    key: \"render\",\n    value: function render() {\n      var renderChildren = this.props.children;\n      return this.renderWrapper(renderChildren);\n    }\n  }]);\n  return RecursiveConsumerBridge;\n}(React.PureComponent); // 若支持 Hooks，就不需要递归了，相关实现解释可参考 ConsumerWrapper\n\nvar _filehash$4 = \"46lG\";\n// 兼容性检测\nvar isSupported = _isFunction(React.lazy) && !_isUndefined(React.Suspense);\nvar SusNotSupported = function SusNotSupported(_ref) {\n  var children = _ref.children;\n  return _run(children);\n};\nvar Lazy = isSupported ? /*#__PURE__*/React.lazy(function () {\n  return new Promise(function () {\n    return null;\n  });\n}) : function () {\n  return null;\n};\nvar FallbackListener = /*#__PURE__*/function (_Component) {\n  _inherits(FallbackListener, _Component);\n  var _super = _createSuper(FallbackListener);\n  function FallbackListener() {\n    _classCallCheck(this, FallbackListener);\n    return _super.apply(this, arguments);\n  }\n  _createClass(FallbackListener, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      _run(this.props, 'onStart');\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      _run(this.props, 'onEnd');\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      return null;\n    }\n  }]);\n  return FallbackListener;\n}(React.Component);\nfunction SuspenseBridge(_ref2) {\n  var children = _ref2.children,\n    sus$$ = _ref2.sus$$;\n  return (/*#__PURE__*/\n    // 捕获 Keeper 内部可能存在的 lazy，并触发对应 KeepAlive 位置上的 LazyBridge\n    React__default.createElement(React.Suspense, {\n      fallback: /*#__PURE__*/React__default.createElement(FallbackListener, {\n        onStart: sus$$.onSuspenseStart,\n        onEnd: sus$$.onSuspenseEnd,\n        _nk: \"\".concat(_filehash$4, \"21\")\n      }),\n      _nk: \"\".concat(_filehash$4, \"11\")\n    }, children)\n  );\n}\nvar LazyBridge = isSupported ? /*#__PURE__*/function (_Component2) {\n  _inherits(LazyBridge, _Component2);\n  var _super2 = _createSuper(LazyBridge);\n  function LazyBridge() {\n    var _this;\n    _classCallCheck(this, LazyBridge);\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n    _this = _super2.call.apply(_super2, [this].concat(args));\n    _defineProperty(_assertThisInitialized(_this), \"state\", {\n      suspense: false\n    });\n    _defineProperty(_assertThisInitialized(_this), \"onSuspenseStart\", function () {\n      _this.setState({\n        suspense: true\n      });\n    });\n    _defineProperty(_assertThisInitialized(_this), \"onSuspenseEnd\", function () {\n      _this.setState({\n        suspense: false\n      });\n    });\n    _defineProperty(_assertThisInitialized(_this), \"sus$$\", {\n      onSuspenseStart: _this.onSuspenseStart,\n      onSuspenseEnd: _this.onSuspenseEnd\n    });\n    return _this;\n  }\n  _createClass(LazyBridge, [{\n    key: \"render\",\n    value: function render() {\n      var children = this.props.children;\n      return /*#__PURE__*/React__default.createElement(React.Fragment, null, _run(children, undefined, this.sus$$), this.state.suspense && /*#__PURE__*/React__default.createElement(Lazy, {\n        _nk: \"\".concat(_filehash$4, \"31\")\n      }));\n    }\n  }]);\n  return LazyBridge;\n}(React.Component) : SusNotSupported;\nvar SuspenseBridge$1 = isSupported ? SuspenseBridge : SusNotSupported;\nvar ErrorBoundaryBridge = /*#__PURE__*/function (_Component) {\n  _inherits(ErrorBoundaryBridge, _Component);\n  var _super = _createSuper(ErrorBoundaryBridge);\n  function ErrorBoundaryBridge() {\n    _classCallCheck(this, ErrorBoundaryBridge);\n    return _super.apply(this, arguments);\n  }\n  _createClass(ErrorBoundaryBridge, [{\n    key: \"componentDidCatch\",\n    value:\n    // Error Boundary 透传至对应 KeepAlive 实例位置\n\n    function componentDidCatch(error) {\n      var throwError = this.props.error$$;\n      _run(throwError, undefined, error, function () {\n        _run(throwError, undefined, null);\n      });\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      return this.props.children;\n    }\n  }]);\n  return ErrorBoundaryBridge;\n}(React.Component);\n_defineProperty(ErrorBoundaryBridge, \"getDerivedStateFromError\", function () {\n  return null;\n});\nvar ErrorThrower = /*#__PURE__*/function (_Component2) {\n  _inherits(ErrorThrower, _Component2);\n  var _super2 = _createSuper(ErrorThrower);\n  function ErrorThrower() {\n    var _this;\n    _classCallCheck(this, ErrorThrower);\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n    _this = _super2.call.apply(_super2, [this].concat(args));\n    _defineProperty(_assertThisInitialized(_this), \"state\", {\n      error: null\n    });\n    _defineProperty(_assertThisInitialized(_this), \"throwError\", function (error, cb) {\n      return _this.setState({\n        error: error\n      }, cb);\n    });\n    return _this;\n  }\n  _createClass(ErrorThrower, [{\n    key: \"render\",\n    value: function render() {\n      if (this.state.error) {\n        throw this.state.error;\n      }\n      return _run(this.props.children, undefined, this.throwError);\n    }\n  }]);\n  return ErrorThrower;\n}(React.Component);\n\n// 用于 Keeper 中，实现 Keeper 向外或向内的桥接代理\nvar _filehash$5 = \"lajT\";\nfunction Bridge(_ref) {\n  var id = _ref.id,\n    children = _ref.children,\n    bridgeProps = _ref.bridgeProps;\n  var sus$$ = bridgeProps.sus$$,\n    ctx$$ = bridgeProps.ctx$$,\n    error$$ = bridgeProps.error$$;\n  return /*#__PURE__*/ /* 由内向外透传 componentDidCatch 捕获的 error */React__default.createElement(ErrorBoundaryBridge, {\n    error$$: error$$,\n    _nk: \"\".concat(_filehash$5, \"11\")\n  }, /*#__PURE__*/React__default.createElement(SuspenseBridge$1, {\n    sus$$: sus$$,\n    _nk: \"\".concat(_filehash$5, \"21\")\n  }, /*#__PURE__*/React__default.createElement(ProviderBridge, {\n    id: id,\n    value: ctx$$,\n    _nk: \"\".concat(_filehash$5, \"31\")\n  }, children)));\n}\n\n// 用于 KeepAlive 中，实现 KeepAlive 向外或向内的桥接代理\nfunction Acceptor(_ref2) {\n  var id = _ref2.id,\n    children = _ref2.children;\n  return /*#__PURE__*/ /* 由内向外透传 componentDidCatch 捕获的 error */React__default.createElement(ErrorThrower, {\n    _nk: \"\".concat(_filehash$5, \"41\")\n  }, function (error$$) {\n    return /*#__PURE__*/ /* 由内向外透传 lazy 行为 */React__default.createElement(LazyBridge, {\n      _nk: \"\".concat(_filehash$5, \"51\")\n    }, function (sus$$) {\n      return /*#__PURE__*/ /* 由外向内透传可能被捕获的 Provider 数据 */React__default.createElement(RecursiveConsumerBridge, {\n        id: id,\n        _nk: \"\".concat(_filehash$5, \"61\")\n      }, function (ctx$$) {\n        return _run(children, undefined, {\n          bridgeProps: {\n            sus$$: sus$$,\n            ctx$$: ctx$$,\n            error$$: error$$\n          }\n        });\n      });\n    });\n  });\n}\nvar _excluded$1 = [\"forwardedRef\"];\nvar _filehash$6 = \"XKTv\";\nvar LIFECYCLE_ACTIVATE = 'componentDidActivate';\nvar LIFECYCLE_UNACTIVATE = 'componentWillUnactivate';\nvar withActivation = function withActivation(WrappedComponent) {\n  var HOC = /*#__PURE__*/function (_Component) {\n    _inherits(HOC, _Component);\n    var _super = _createSuper(HOC);\n    function HOC() {\n      var _this;\n      _classCallCheck(this, HOC);\n      for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n        args[_key] = arguments[_key];\n      }\n      _this = _super.call.apply(_super, [this].concat(args));\n      _defineProperty(_assertThisInitialized(_this), \"drop\", null);\n      return _this;\n    }\n    _createClass(HOC, [{\n      key: \"componentWillUnmount\",\n      value: function componentWillUnmount() {\n        _run(this.drop);\n      }\n    }, {\n      key: \"render\",\n      value: function render() {\n        var _this2 = this;\n        var _this$props = this.props,\n          forwardedRef = _this$props.forwardedRef,\n          props = _objectWithoutProperties(_this$props, _excluded$1);\n        return /*#__PURE__*/React__default.createElement(AliveNodeConsumer, {\n          _nk: \"\".concat(_filehash$6, \"11\")\n        }, function () {\n          var _ref = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},\n            attach = _ref.attach;\n          return /*#__PURE__*/React__default.createElement(WrappedComponent, _extends({\n            ref: function ref(_ref2) {\n              if ([LIFECYCLE_ACTIVATE, LIFECYCLE_UNACTIVATE].every(function (lifecycleName) {\n                return !_isFunction(_get(_ref2, lifecycleName));\n              })) {\n                return;\n              }\n              _this2.drop = _run(attach, undefined, _ref2);\n\n              // 以下保持 ref 功能\n              if (_isUndefined(forwardedRef)) {\n                return;\n              }\n              if (_isObject(forwardedRef) && 'current' in forwardedRef) {\n                forwardedRef.current = _ref2;\n                return;\n              }\n              _run(forwardedRef, undefined, _ref2);\n            }\n          }, props, {\n            _nk: \"\".concat(_filehash$6, \"21\")\n          }));\n        });\n      }\n    }]);\n    return HOC;\n  }(React.Component); // 由于 KeepAlive 内组件渲染与实际内容落后一个节拍\n  // 将导致真实节点的 componentDidMount 无法及时获取到 KeepAlive 中内容的 ref 值\n  // 此处对使用了 withActivation HOC 的组件 componentDidMount 做 nextTick 延时处理\n  // 修复上述问题\n  if (_isFunction(WrappedComponent.prototype.componentDidMount)) {\n    WrappedComponent.prototype._componentDidMount = WrappedComponent.prototype.componentDidMount;\n    WrappedComponent.prototype.componentDidMount = function componentDidMount() {\n      var _this3 = this;\n      _nextTick(function () {\n        return WrappedComponent.prototype._componentDidMount.call(_this3);\n      });\n    };\n  }\n  if (_isFunction(React.forwardRef)) {\n    var ForwardedRefHOC = /*#__PURE__*/React.forwardRef(function (props, ref) {\n      return /*#__PURE__*/React__default.createElement(HOC, _extends({}, props, {\n        forwardedRef: ref,\n        _nk: \"\".concat(_filehash$6, \"31\")\n      }));\n    });\n    return hoistStatics(ForwardedRefHOC, WrappedComponent);\n  } else {\n    return hoistStatics(HOC, WrappedComponent);\n  }\n};\nvar useActivation = function useActivation(funcName, func) {\n  // 兼容性判断\n  if ([React.useRef, React.useContext, React.useEffect].some(function (fn) {\n    return !_isFunction(fn);\n  })) {\n    return;\n  }\n  var ctxValue = React.useContext(aliveNodeContext);\n\n  // 未处于 KeepAlive 中\n  if (!ctxValue) {\n    return;\n  }\n  var _useRef = React.useRef({}),\n    ref = _useRef.current;\n  var attach = ctxValue.attach;\n  ref[funcName] = func;\n  ref.drop = attach(ref);\n  React.useEffect(function () {\n    return function () {\n      return _run(ref.drop);\n    };\n  }, []);\n};\nvar useActivate = useActivation.bind(null, LIFECYCLE_ACTIVATE);\nvar useUnactivate = useActivation.bind(null, LIFECYCLE_UNACTIVATE);\nvar _excluded$2 = [\"id\", \"autoFreeze\"];\nvar _filehash$7 = \"bNyU\";\nvar Freeze$1 = !!React.Suspense ? Freeze : function (_ref) {\n  var children = _ref.children;\n  return children;\n};\nvar Keeper = /*#__PURE__*/function (_PureComponent) {\n  _inherits(Keeper, _PureComponent);\n  var _super = _createSuper(Keeper);\n  function Keeper(props) {\n    var _this;\n    _classCallCheck(this, Keeper);\n    for (var _len = arguments.length, rest = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n      rest[_key - 1] = arguments[_key];\n    }\n    _this = _super.call.apply(_super, [this, props].concat(rest));\n    _defineProperty(_assertThisInitialized(_this), \"eventBus\", new _EventBus());\n    _defineProperty(_assertThisInitialized(_this), \"listeners\", new Map());\n    _defineProperty(_assertThisInitialized(_this), \"wrapper\", null);\n    _defineProperty(_assertThisInitialized(_this), \"cache\", undefined);\n    _defineProperty(_assertThisInitialized(_this), \"unmounted\", false);\n    _defineProperty(_assertThisInitialized(_this), \"safeSetState\", function (nextState, callback) {\n      // fix #170\n      if (_this.unmounted) {\n        return;\n      }\n      _this.setState(nextState, callback);\n    });\n    _defineProperty(_assertThisInitialized(_this), \"freezeTimeout\", null);\n    // // 原先打算更新过程中先重置 dom 节点状态，更新后恢复 dom 节点\n    // // 但考虑到性能消耗可能过大，且可能因 dom 操作时机引发其他 react 渲染问题，故不使用\n    // // 对应 KeepAlive 处 update 也注释起来不使用\n    // // 组件更新后，更新 DOM 节点列表状态\n    // componentDidUpdate() {\n    //   const { store, id } = this.props\n    //   const node = this.wrapper\n    //   if (get(node, 'children.length') > 0) {\n    //     store[id].nodes = [...node.children]\n    //   }\n    //   console.log(store[id].nodes)\n    // }\n    // 生命周期绑定\n    _defineProperty(_assertThisInitialized(_this), \"attach\", function (ref) {\n      var _listeners$set;\n      var listeners = _this.listeners;\n      if (!ref) {\n        return function () {\n          return null;\n        };\n      }\n      if (ref.isKeepAlive) {\n        _nextTick(function () {\n          var _this$props = _this.props,\n            id = _this$props.id,\n            store = _this$props.store;\n          var cache = store.get(id);\n          cache.aliveNodesId = new Set([].concat(_toConsumableArray(cache.aliveNodesId), [ref.id]));\n        });\n      }\n      listeners.set(ref, (_listeners$set = {}, _defineProperty(_listeners$set, LIFECYCLE_ACTIVATE, function () {\n        return _run(ref, LIFECYCLE_ACTIVATE);\n      }), _defineProperty(_listeners$set, LIFECYCLE_UNACTIVATE, function () {\n        return _run(ref, LIFECYCLE_UNACTIVATE);\n      }), _listeners$set));\n\n      // 返回 listenerRemover 用以在对应组件卸载时解除监听\n      return function () {\n        listeners[\"delete\"](ref);\n      };\n    });\n    // 静态化节点上下文内容，防止重复渲染\n    _defineProperty(_assertThisInitialized(_this), \"contextValue\", {\n      id: _this.props.id,\n      attach: _this.attach\n    });\n    _defineProperty(_assertThisInitialized(_this), \"drop\", function () {\n      var _ref2 = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},\n        _ref2$delay = _ref2.delay,\n        delay = _ref2$delay === void 0 ? 1200 : _ref2$delay;\n      return new Promise(function (resolve) {\n        var timeout;\n        var _this$props2 = _this.props,\n          scope = _this$props2.scope,\n          id = _this$props2.id;\n        var drop = function drop() {\n          clearTimeout(timeout);\n          _this.eventBus.off(LIFECYCLE_UNACTIVATE, drop);\n          // 用在多层 KeepAlive 同时触发 drop 时，避免触发深层 KeepAlive 节点的缓存生命周期\n          _this.cache.willDrop = true;\n          scope.nodes[\"delete\"](id);\n          scope.helpers = _objectSpread2({}, scope.helpers);\n          scope.smartForceUpdate(function () {\n            return resolve(true);\n          });\n        };\n        var canDrop = _get(_this.cache, 'cached') || _get(_this.cache, 'willDrop');\n        if (!canDrop) {\n          _this.eventBus.on(LIFECYCLE_UNACTIVATE, drop);\n          timeout = setTimeout(function () {\n            _this.eventBus.off(LIFECYCLE_UNACTIVATE, drop);\n            resolve(false);\n          }, delay);\n          return;\n        }\n        drop();\n      });\n    });\n    _defineProperty(_assertThisInitialized(_this), \"refresh\", function () {\n      return new Promise(function (resolve) {\n        var canRefresh = !_get(_this.cache, 'cached');\n        if (!canRefresh) {\n          resolve(false);\n        }\n        _this.safeSetState({\n          key: Math.random()\n        }, function () {\n          return resolve(true);\n        });\n      });\n    });\n    _this.state = {\n      children: props.children,\n      bridgeProps: props.bridgeProps,\n      key: Math.random(),\n      freeze: false\n    };\n    return _this;\n  }\n  _createClass(Keeper, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var _this2 = this,\n        _this$cache;\n      var _this$props3 = this.props,\n        store = _this$props3.store,\n        id = _this$props3.id;\n      var listeners = this.listeners;\n      var node = this.wrapper;\n\n      // 已存在检测，防止意外现象\n      if (store.has(id)) {\n        return;\n      }\n      var nodes;\n      try {\n        nodes = _toConsumableArray(node.children);\n      } catch (e) {\n        nodes = [node.children];\n      }\n      this.cache = (_this$cache = {\n        listeners: listeners,\n        aliveNodesId: [],\n        inited: false,\n        cached: false,\n        wrapper: node,\n        nodes: nodes\n      }, _defineProperty(_this$cache, LIFECYCLE_ACTIVATE, function () {\n        return _this2[LIFECYCLE_ACTIVATE]();\n      }), _defineProperty(_this$cache, LIFECYCLE_UNACTIVATE, function () {\n        return _this2[LIFECYCLE_UNACTIVATE]();\n      }), _this$cache);\n      store.set(id, this.cache);\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      var _this$props4 = this.props,\n        store = _this$props4.store,\n        keepers = _this$props4.keepers,\n        id = _this$props4.id;\n      // 卸载前尝试归位 DOM 节点\n      try {\n        var cache = store.get(id);\n        cache.nodes.forEach(function (node) {\n          cache.wrapper.appendChild(node);\n        });\n      } catch (error) {\n        // console.error(error) // do nothing\n      }\n      store[\"delete\"](id);\n      keepers[\"delete\"](id);\n      this.unmounted = true;\n    }\n  }, {\n    key: LIFECYCLE_ACTIVATE,\n    value: function value() {\n      clearTimeout(this.freezeTimeout);\n      // 激活后，立即解冻\n      this.safeSetState({\n        freeze: false\n      });\n      this.eventBus.emit(LIFECYCLE_ACTIVATE);\n      this.listeners.forEach(function (listener) {\n        return _run(listener, [LIFECYCLE_ACTIVATE]);\n      });\n    }\n  }, {\n    key: LIFECYCLE_UNACTIVATE,\n    value: function value() {\n      var _this3 = this;\n      this.eventBus.emit(LIFECYCLE_UNACTIVATE);\n      var listeners = _toConsumableArray(this.listeners);\n      listeners.reverse().forEach(function (_ref3) {\n        var _ref4 = _slicedToArray(_ref3, 2),\n          listener = _ref4[1];\n        return _run(listener, [LIFECYCLE_UNACTIVATE]);\n      });\n\n      // 缓存后，延迟冻结，保证各项后续处理得以进行，如关闭弹窗等\n      clearTimeout(this.freezeTimeout);\n      this.freezeTimeout = setTimeout(function () {\n        reactDom.flushSync(function () {\n          _this3.safeSetState({\n            freeze: true\n          });\n        });\n      }, 1000);\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this4 = this;\n      var _this$props5 = this.props,\n        id = _this$props5.id,\n        _this$props5$autoFree = _this$props5.autoFreeze,\n        autoFreeze = _this$props5$autoFree === void 0 ? true : _this$props5$autoFree,\n        props = _objectWithoutProperties(_this$props5, _excluded$2);\n      var _this$state = this.state,\n        children = _this$state.children,\n        bridgeProps = _this$state.bridgeProps,\n        key = _this$state.key,\n        freeze = _this$state.freeze;\n      return /*#__PURE__*/React__default.createElement(Freeze$1, {\n        freeze: autoFreeze && freeze,\n        _nk: \"\".concat(_filehash$7, \"11\")\n      }, /*#__PURE__*/React__default.createElement(\"div\", {\n        ref: function ref(node) {\n          _this4.wrapper = node;\n        },\n        _nk: \"\".concat(_filehash$7, \"21\")\n      }, /*#__PURE__*/React__default.createElement(\"div\", {\n        key: \"keeper-container\",\n        className: \"ka-content\"\n      }, /*#__PURE__*/React__default.createElement(Bridge, {\n        id: id,\n        bridgeProps: bridgeProps,\n        _nk: \"\".concat(_filehash$7, \"31\")\n      }, /*#__PURE__*/React__default.createElement(AliveNodeProvider, {\n        value: this.contextValue,\n        _nk: \"\".concat(_filehash$7, \"41\")\n      }, React__default.Children.map(children, function (child, idx) {\n        return /*#__PURE__*/React__default.cloneElement(child, {\n          key: \"\".concat(child.key || '', \":\").concat(key, \":\").concat(idx)\n        });\n      }))))));\n    }\n  }]);\n  return Keeper;\n}(React.PureComponent);\nvar _excluded$3 = [\"children\"];\nvar _filehash$8 = \"UVSV\";\nvar HANDLE_TYPE_DROP = 'drop';\nvar HANDLE_TYPE_REFRESH = 'refresh';\nvar AliveScope = /*#__PURE__*/function (_Component) {\n  _inherits(AliveScope, _Component);\n  var _super = _createSuper(AliveScope);\n  function AliveScope() {\n    var _this;\n    _classCallCheck(this, AliveScope);\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n    _this = _super.call.apply(_super, [this].concat(args));\n    _defineProperty(_assertThisInitialized(_this), \"store\", new Map());\n    _defineProperty(_assertThisInitialized(_this), \"nodes\", new Map());\n    _defineProperty(_assertThisInitialized(_this), \"keepers\", new Map());\n    _defineProperty(_assertThisInitialized(_this), \"debouncedForceUpdate\", _debounce(function (cb) {\n      return _this.forceUpdate(cb);\n    }));\n    _defineProperty(_assertThisInitialized(_this), \"updateCallbackList\", []);\n    _defineProperty(_assertThisInitialized(_this), \"smartForceUpdate\", function (cb) {\n      _this.updateCallbackList.push(cb);\n      _this.debouncedForceUpdate(function () {\n        _this.updateCallbackList.forEach(function (cb) {\n          return _run(cb);\n        });\n        _this.updateCallbackList = [];\n      });\n    });\n    _defineProperty(_assertThisInitialized(_this), \"update\", function (id, params) {\n      return new Promise(function (resolve) {\n        var keeper = _this.keepers.get(id);\n        var isNew = !keeper;\n        var now = Date.now();\n        var node = _this.nodes.get(id) || null;\n        _this.nodes.set(id, _objectSpread2(_objectSpread2({\n          id: id,\n          createTime: now,\n          updateTime: now\n        }, node), params));\n        if (isNew) {\n          _this.helpers = _objectSpread2({}, _this.helpers);\n          _this.forceUpdate(resolve);\n        } else {\n          var children = params.children,\n            bridgeProps = params.bridgeProps;\n          keeper.setState({\n            children: children,\n            bridgeProps: bridgeProps\n          }, resolve);\n        }\n      });\n    });\n    _defineProperty(_assertThisInitialized(_this), \"keep\", function (id, params) {\n      return new Promise(function (resolve) {\n        _this.update(id, _objectSpread2({\n          id: id\n        }, params)).then(function () {\n          resolve(_this.store.get(id));\n        });\n      });\n    });\n    _defineProperty(_assertThisInitialized(_this), \"getCachingNodesByName\", function (name) {\n      return _this.getCachingNodes().filter(function (node) {\n        return isRegExp(name) ? name.test(node.name) : node.name === name;\n      });\n    });\n    _defineProperty(_assertThisInitialized(_this), \"getScopeIds\", function (ids) {\n      // 递归采集 scope alive nodes id\n      var getCachingNodesId = function getCachingNodesId(id) {\n        var aliveNodesId = _get(_this.getCache(id), 'aliveNodesId', []);\n        if (aliveNodesId.size > 0) {\n          return [id, _toConsumableArray(aliveNodesId).map(getCachingNodesId)];\n        }\n        return [id].concat(_toConsumableArray(aliveNodesId));\n      };\n      return _flatten(ids.map(function (id) {\n        return getCachingNodesId(id);\n      }));\n    });\n    _defineProperty(_assertThisInitialized(_this), \"dropById\", function (id) {\n      var _this2;\n      for (var _len2 = arguments.length, rest = new Array(_len2 > 1 ? _len2 - 1 : 0), _key2 = 1; _key2 < _len2; _key2++) {\n        rest[_key2 - 1] = arguments[_key2];\n      }\n      return (_this2 = _this).handleNodes.apply(_this2, [[id], HANDLE_TYPE_DROP].concat(rest));\n    });\n    _defineProperty(_assertThisInitialized(_this), \"dropScopeByIds\", function (ids) {\n      var _this3;\n      for (var _len3 = arguments.length, rest = new Array(_len3 > 1 ? _len3 - 1 : 0), _key3 = 1; _key3 < _len3; _key3++) {\n        rest[_key3 - 1] = arguments[_key3];\n      }\n      return (_this3 = _this).handleNodes.apply(_this3, [_this.getScopeIds(ids), HANDLE_TYPE_DROP].concat(rest));\n    });\n    _defineProperty(_assertThisInitialized(_this), \"drop\", function (name) {\n      var _this4;\n      for (var _len4 = arguments.length, rest = new Array(_len4 > 1 ? _len4 - 1 : 0), _key4 = 1; _key4 < _len4; _key4++) {\n        rest[_key4 - 1] = arguments[_key4];\n      }\n      return (_this4 = _this).handleNodes.apply(_this4, [_this.getCachingNodesByName(name).map(function (node) {\n        return node.id;\n      }), HANDLE_TYPE_DROP].concat(rest));\n    });\n    _defineProperty(_assertThisInitialized(_this), \"dropScope\", function (name) {\n      var _this5;\n      for (var _len5 = arguments.length, rest = new Array(_len5 > 1 ? _len5 - 1 : 0), _key5 = 1; _key5 < _len5; _key5++) {\n        rest[_key5 - 1] = arguments[_key5];\n      }\n      return (_this5 = _this).dropScopeByIds.apply(_this5, [_this.getCachingNodesByName(name).map(function (_ref) {\n        var id = _ref.id;\n        return id;\n      })].concat(rest));\n    });\n    _defineProperty(_assertThisInitialized(_this), \"refreshById\", function (id) {\n      var _this6;\n      for (var _len6 = arguments.length, rest = new Array(_len6 > 1 ? _len6 - 1 : 0), _key6 = 1; _key6 < _len6; _key6++) {\n        rest[_key6 - 1] = arguments[_key6];\n      }\n      return (_this6 = _this).handleNodes.apply(_this6, [[id], HANDLE_TYPE_REFRESH].concat(rest));\n    });\n    _defineProperty(_assertThisInitialized(_this), \"refreshScopeByIds\", function (ids) {\n      var _this7;\n      for (var _len7 = arguments.length, rest = new Array(_len7 > 1 ? _len7 - 1 : 0), _key7 = 1; _key7 < _len7; _key7++) {\n        rest[_key7 - 1] = arguments[_key7];\n      }\n      return (_this7 = _this).handleNodes.apply(_this7, [_this.getScopeIds(ids), HANDLE_TYPE_REFRESH].concat(rest));\n    });\n    _defineProperty(_assertThisInitialized(_this), \"refresh\", function (name) {\n      var _this8;\n      for (var _len8 = arguments.length, rest = new Array(_len8 > 1 ? _len8 - 1 : 0), _key8 = 1; _key8 < _len8; _key8++) {\n        rest[_key8 - 1] = arguments[_key8];\n      }\n      return (_this8 = _this).handleNodes.apply(_this8, [_this.getCachingNodesByName(name).map(function (node) {\n        return node.id;\n      }), HANDLE_TYPE_REFRESH].concat(rest));\n    });\n    _defineProperty(_assertThisInitialized(_this), \"refreshScope\", function (name) {\n      var _this9;\n      for (var _len9 = arguments.length, rest = new Array(_len9 > 1 ? _len9 - 1 : 0), _key9 = 1; _key9 < _len9; _key9++) {\n        rest[_key9 - 1] = arguments[_key9];\n      }\n      return (_this9 = _this).refreshScopeByIds.apply(_this9, [_this.getCachingNodesByName(name).map(function (_ref2) {\n        var id = _ref2.id;\n        return id;\n      })].concat(rest));\n    });\n    _defineProperty(_assertThisInitialized(_this), \"handleNodes\", function (nodesId) {\n      var type = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : HANDLE_TYPE_DROP;\n      for (var _len10 = arguments.length, rest = new Array(_len10 > 2 ? _len10 - 2 : 0), _key10 = 2; _key10 < _len10; _key10++) {\n        rest[_key10 - 2] = arguments[_key10];\n      }\n      return new Promise(function (resolve) {\n        var handleKeepers = [];\n        nodesId.forEach(function (id) {\n          var cache = _this.store.get(id);\n          if (!cache) {\n            return;\n          }\n          var keeper = _this.keepers.get(id);\n          handleKeepers.push(keeper);\n        });\n        if (handleKeepers.length === 0) {\n          resolve(false);\n          return;\n        }\n        Promise.all(handleKeepers.map(function (keeper) {\n          return _run.apply(void 0, [keeper, type].concat(rest));\n        })).then(function (responses) {\n          return resolve(responses.every(Boolean));\n        });\n      });\n    });\n    _defineProperty(_assertThisInitialized(_this), \"clear\", function () {\n      var _this10;\n      for (var _len11 = arguments.length, rest = new Array(_len11), _key11 = 0; _key11 < _len11; _key11++) {\n        rest[_key11] = arguments[_key11];\n      }\n      return (_this10 = _this).handleNodes.apply(_this10, [_this.getCachingNodes().map(function (_ref3) {\n        var id = _ref3.id;\n        return id;\n      }), HANDLE_TYPE_DROP].concat(rest));\n    });\n    _defineProperty(_assertThisInitialized(_this), \"getCache\", function (id) {\n      return _this.store.get(id);\n    });\n    _defineProperty(_assertThisInitialized(_this), \"getNode\", function (id) {\n      return _this.nodes.get(id);\n    });\n    _defineProperty(_assertThisInitialized(_this), \"getCachingNodes\", function () {\n      return _toConsumableArray(_this.nodes.values());\n    });\n    // 静态化节点上下文内容，防止重复渲染\n    _defineProperty(_assertThisInitialized(_this), \"helpers\", {\n      keep: _this.keep,\n      update: _this.update,\n      drop: _this.drop,\n      dropScope: _this.dropScope,\n      dropById: _this.dropById,\n      dropScopeByIds: _this.dropScopeByIds,\n      refresh: _this.refresh,\n      refreshScope: _this.refreshScope,\n      refreshById: _this.refreshById,\n      refreshScopeByIds: _this.refreshScopeByIds,\n      getScopeIds: _this.getScopeIds,\n      clear: _this.clear,\n      getCache: _this.getCache,\n      getNode: _this.getNode,\n      getCachingNodes: _this.getCachingNodes\n    });\n    return _this;\n  }\n  _createClass(AliveScope, [{\n    key: \"render\",\n    value: function render() {\n      var _this11 = this;\n      var _this$props$children = this.props.children,\n        children = _this$props$children === void 0 ? null : _this$props$children;\n      return /*#__PURE__*/React__default.createElement(AliveScopeProvider$1, {\n        value: this.helpers,\n        _nk: \"\".concat(_filehash$8, \"11\")\n      }, children, /*#__PURE__*/React__default.createElement(\"div\", {\n        style: {\n          display: 'none'\n        },\n        _nk: \"\".concat(_filehash$8, \"21\")\n      }, _toConsumableArray(this.nodes.values()).map(function (_ref4) {\n        var children = _ref4.children,\n          props = _objectWithoutProperties(_ref4, _excluded$3);\n        return /*#__PURE__*/React__default.createElement(Keeper, _extends({\n          key: props.id\n        }, props, {\n          scope: _this11,\n          store: _this11.store,\n          keepers: _this11.keepers,\n          ref: function ref(keeper) {\n            _this11.keepers.set(props.id, keeper);\n          },\n          _nk: \"iAr\".concat(_filehash$8, \"31\")\n        }), children);\n      })));\n    }\n  }]);\n  return AliveScope;\n}(React.Component);\nvar _excluded$4 = [\"id\"],\n  _excluded2 = [\"id\"],\n  _excluded3 = [\"forwardedRef\"],\n  _excluded4 = [\"forwardedRef\"];\nvar _filehash$9 = \"X7Aa\";\nfunction controllerCherryPick(controller) {\n  var drop = controller.drop,\n    dropScope = controller.dropScope,\n    refresh = controller.refresh,\n    refreshScope = controller.refreshScope,\n    clear = controller.clear,\n    getCachingNodes = controller.getCachingNodes;\n  return {\n    drop: drop,\n    dropScope: dropScope,\n    refresh: refresh,\n    refreshScope: refreshScope,\n    clear: clear,\n    getCachingNodes: getCachingNodes\n  };\n}\nvar expandKeepAlive = function expandKeepAlive(KeepAlive) {\n  var renderContent = function renderContent(_ref) {\n    var idPrefix = _ref.idPrefix,\n      helpers = _ref.helpers,\n      props = _ref.props;\n    var isOutsideAliveScope = _isUndefined(helpers);\n    if (isOutsideAliveScope) {\n      console.error('You should not use <KeepAlive /> outside a <AliveScope>');\n    }\n    return isOutsideAliveScope ? _get(props, 'children', null) : /*#__PURE__*/React__default.createElement(NodeKey, {\n      prefix: idPrefix,\n      key: props._nk,\n      manualKey: props.cacheKey,\n      _nk: \"\".concat(_filehash$9, \"11\")\n    }, function (nkId) {\n      var id = props.cacheKey || nkId;\n      return /*#__PURE__*/React__default.createElement(Acceptor, {\n        key: id,\n        id: id,\n        _nk: \"\".concat(_filehash$9, \"21\")\n      }, function (bridgeProps) {\n        return /*#__PURE__*/React__default.createElement(KeepAlive, _extends({\n          key: id\n        }, props, bridgeProps, {\n          id: id,\n          _helpers: helpers,\n          _nk: \"\".concat(_filehash$9, \"31\")\n        }));\n      });\n    });\n  };\n  var HookExpand = function HookExpand(_ref2) {\n    var idPrefix = _ref2.id,\n      props = _objectWithoutProperties(_ref2, _excluded$4);\n    return renderContent({\n      idPrefix: idPrefix,\n      helpers: useScopeContext(),\n      props: props\n    });\n  };\n  var WithExpand = function WithExpand(_ref3) {\n    var idPrefix = _ref3.id,\n      props = _objectWithoutProperties(_ref3, _excluded2);\n    return /*#__PURE__*/React__default.createElement(AliveScopeConsumer$1, {\n      _nk: \"\".concat(_filehash$9, \"41\")\n    }, function (helpers) {\n      return renderContent({\n        idPrefix: idPrefix,\n        helpers: helpers,\n        props: props\n      });\n    });\n  };\n  return _isFunction(React.useContext) ? HookExpand : WithExpand;\n};\nvar withAliveScope = function withAliveScope(WrappedComponent) {\n  var renderContent = function renderContent(_ref4) {\n    var helpers = _ref4.helpers,\n      props = _ref4.props,\n      forwardedRef = _ref4.forwardedRef;\n    return /*#__PURE__*/React__default.createElement(WrappedComponent, _extends({}, props, helpers, {\n      ref: forwardedRef,\n      _nk: \"\".concat(_filehash$9, \"51\")\n    }));\n  };\n  var HookScope = function HookScope(_ref5) {\n    var forwardedRef = _ref5.forwardedRef,\n      props = _objectWithoutProperties(_ref5, _excluded3);\n    return renderContent({\n      helpers: controllerCherryPick(useScopeContext() || {}),\n      props: props,\n      forwardedRef: forwardedRef\n    });\n  };\n  var WithScope = function WithScope(_ref6) {\n    var forwardedRef = _ref6.forwardedRef,\n      props = _objectWithoutProperties(_ref6, _excluded4);\n    return /*#__PURE__*/React__default.createElement(AliveScopeConsumer$1, {\n      _nk: \"\".concat(_filehash$9, \"42\")\n    }, function () {\n      var controller = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n      return renderContent({\n        helpers: controllerCherryPick(controller),\n        props: props,\n        forwardedRef: forwardedRef\n      });\n    });\n  };\n  var HOCWithAliveScope = _isFunction(React.useContext) ? HookScope : WithScope;\n  if (_isFunction(React.forwardRef)) {\n    var ForwardedRefHOC = /*#__PURE__*/React.forwardRef(function (props, ref) {\n      return /*#__PURE__*/React__default.createElement(HOCWithAliveScope, _extends({}, props, {\n        forwardedRef: ref,\n        _nk: \"\".concat(_filehash$9, \"61\")\n      }));\n    });\n    return hoistStatics(ForwardedRefHOC, WrappedComponent);\n  } else {\n    return hoistStatics(HOCWithAliveScope, WrappedComponent);\n  }\n};\nvar useAliveController = function useAliveController() {\n  if (!_isFunction(React.useContext)) {\n    return {};\n  }\n  var ctxValue = useScopeContext();\n  if (!ctxValue) {\n    return {};\n  }\n  return controllerCherryPick(ctxValue);\n};\nfunction isScrollableNode() {\n  var node = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n  if (!_isExist(node)) {\n    return false;\n  }\n  return node.scrollWidth > node.clientWidth || node.scrollHeight > node.clientHeight;\n}\nfunction getScrollableNodes(from) {\n  if (!_isFunction(_get(_globalThis, 'document.querySelectorAll'))) {\n    return [];\n  }\n  return [].concat(_toConsumableArray(_value(_run(from, 'querySelectorAll', '*'), [])), [from]).filter(isScrollableNode);\n}\nfunction saveScrollPosition(from) {\n  var nodes = _toConsumableArray(new Set(_toConsumableArray(_flatten(from.map(getScrollableNodes)))));\n  var saver = nodes.map(function (node) {\n    return [node, {\n      x: node.scrollLeft,\n      y: node.scrollTop\n    }];\n  });\n  return function revert() {\n    saver.forEach(function (_ref) {\n      var _ref2 = _slicedToArray(_ref, 2),\n        node = _ref2[0],\n        _ref2$ = _ref2[1],\n        x = _ref2$.x,\n        y = _ref2$.y;\n      node.scrollLeft = x;\n      node.scrollTop = y;\n    });\n  };\n}\nvar _excluded$5 = [\"_helpers\", \"id\", \"children\"],\n  _excluded2$1 = [\"_helpers\", \"id\", \"name\"];\nvar body = _get(_globalThis, 'document.body');\nvar screenScrollingElement = _get(_globalThis, 'document.scrollingElement', _get(_globalThis, 'document.documentElement', {}));\nvar parseWhenResult = function parseWhenResult(res) {\n  if (_isArray(res)) {\n    return res;\n  }\n  return [res];\n};\nvar KeepAlive = /*#__PURE__*/function (_Component) {\n  _inherits(KeepAlive, _Component);\n  var _super = _createSuper(KeepAlive);\n  // 用作 Keeper 识别 KeepAlive\n  // 用作 Keeper 识别 KeepAlive\n\n  function KeepAlive(props) {\n    var _this;\n    _classCallCheck(this, KeepAlive);\n    _this = _super.call(this, props);\n    _defineProperty(_assertThisInitialized(_this), \"id\", null);\n    _defineProperty(_assertThisInitialized(_this), \"isKeepAlive\", true);\n    _defineProperty(_assertThisInitialized(_this), \"cached\", false);\n    // DOM 操作将实际内容插入占位元素\n    _defineProperty(_assertThisInitialized(_this), \"inject\", function () {\n      var didActivate = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : true;\n      var _this$props = _this.props,\n        id = _this$props.id,\n        saveScrollPosition = _this$props.saveScrollPosition,\n        _helpers = _this$props._helpers;\n      var cache = _helpers.getCache(id);\n      // DOM 操作有风险，try catch 护体\n      try {\n        // // 原计划不增加额外的节点，直接将 Keeper 中所有内容节点一一迁移\n        // // 后发现缺乏统一 react 认可的外层包裹，可能会造成 react dom 操作的错误\n        // // 且将导致 KeepAlive 进行 update 时需先恢复各 dom 节点的组件归属，成本过高\n        // // 故此处增加统一的 div 外层，Keeper 中与 KeepAlive 中各一个且外层不做移除处理\n        // this.parentNode = this.placeholder.parentNode\n        // cache.nodes.forEach(node => {\n        //   this.parentNode.insertBefore(node, this.placeholder)\n        // })\n        // this.parentNode.removeChild(this.placeholder)\n        // 将 AliveScopeProvider 中的渲染内容通过 dom 操作置回当前 KeepAlive\n        cache.nodes.forEach(function (node) {\n          _this.placeholder.appendChild(node);\n        });\n        if (didActivate && saveScrollPosition) {\n          // 恢复该节点下各可滚动元素的滚动位置\n          _run(cache.revertScrollPos);\n        }\n      } catch (error) {\n        // console.error(error)\n      }\n    });\n    // DOM 操作将实际内容移出占位元素\n    _defineProperty(_assertThisInitialized(_this), \"eject\", function () {\n      var willUnactivate = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : true;\n      var _this$props2 = _this.props,\n        id = _this$props2.id,\n        _helpers = _this$props2._helpers;\n      var cache = _helpers.getCache(id);\n      var nodesNeedToSaveScrollPosition = _flatten(_flatten([_this.props.saveScrollPosition]).map(function (flag) {\n        if (flag === true) {\n          return cache.nodes;\n        }\n        if (flag === 'screen') {\n          return [screenScrollingElement, body];\n        }\n        return _toConsumableArray(_value(_run(_globalThis, 'document.querySelectorAll', flag), []));\n      })).filter(Boolean);\n\n      // DOM 操作有风险，try catch 护体\n      try {\n        if (willUnactivate && nodesNeedToSaveScrollPosition.length > 0) {\n          // 保存该节点下各可滚动元素的滚动位置\n          cache.revertScrollPos = saveScrollPosition(nodesNeedToSaveScrollPosition);\n        }\n\n        // // 原计划不增加额外的节点，直接将 Keeper 中所有内容节点一一迁移\n        // // 后发现缺乏统一 react 认可的外层包裹，可能会造成 react dom 操作的错误\n        // // 且将导致 KeepAlive 进行 update 时需先恢复各 dom 节点的组件归属，成本过高\n        // // 故此处增加统一的 div 外层，Keeper 中与 KeepAlive 中各一个且外层不做移除处理\n        // this.parentNode.insertBefore(this.placeholder, cache.nodes[0])\n        // cache.nodes.forEach(node => {\n        //   if (willUnactivate) {\n        //     this.parentNode.removeChild(node)\n        //   } else {\n        //     cache.wrapper.appendChild(node)\n        //   }\n        // })\n        // this.parentNode.insertBefore(this.placeholder, cache.nodes[0])\n        // 将 KeepAlive 中的节点恢复为原先的占位节点，保证卸载操作正常进行\n        cache.nodes.forEach(function (node) {\n          if (willUnactivate) {\n            _this.placeholder.removeChild(node);\n          } else {\n            cache.wrapper.appendChild(node);\n          }\n        });\n      } catch (error) {\n        // console.error(error)\n      }\n    });\n    _defineProperty(_assertThisInitialized(_this), \"init\", function () {\n      var _this$props3 = _this.props,\n        _helpers = _this$props3._helpers,\n        id = _this$props3.id,\n        children = _this$props3.children,\n        rest = _objectWithoutProperties(_this$props3, _excluded$5);\n\n      // 将 children 渲染至 AliveScopeProvider 中\n      _helpers.keep(id, _objectSpread2({\n        children: children,\n        getInstance: function getInstance() {\n          return _assertThisInitialized(_this);\n        }\n      }, rest)).then(function (cache) {\n        // fix #22\n        if (!cache) {\n          return;\n        }\n        _this.inject();\n\n        // 触发 didActivate 生命周期\n        if (cache.inited) {\n          _run(_assertThisInitialized(_this), LIFECYCLE_ACTIVATE);\n        } else {\n          cache.inited = true;\n        }\n        _this.cached = false;\n      });\n    });\n    _defineProperty(_assertThisInitialized(_this), \"update\", function () {\n      var _ref = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},\n        _helpers = _ref._helpers,\n        id = _ref.id,\n        name = _ref.name,\n        rest = _objectWithoutProperties(_ref, _excluded2$1);\n      if (!_helpers || _this.cached) {\n        return;\n      }\n\n      // // 原先打算更新过程中先重置 dom 节点状态，更新后恢复 dom 节点\n      // // 但考虑到性能消耗可能过大，且可能因 dom 操作时机引发其他 react 渲染问题，故不使用\n      // // 对应 Keeper 处 componentDidUpdate 也注释起来不使用\n      // this.eject(false)\n      _helpers.update(id, _objectSpread2({\n        name: name,\n        getInstance: function getInstance() {\n          return _assertThisInitialized(_this);\n        }\n      }, rest));\n      // this.inject(false)\n    });\n    _this.id = props.id;\n    _this.init()\n\n    // 继承响应父级 KeepAlive 的生命周期\n    ;\n    [LIFECYCLE_ACTIVATE, LIFECYCLE_UNACTIVATE].forEach(function (lifecycleName) {\n      _this[lifecycleName] = function () {\n        var _this$props4 = _this.props,\n          id = _this$props4.id,\n          _helpers = _this$props4._helpers;\n        var cache = _helpers.getCache(id);\n        var node = _helpers.getNode(id);\n        if (node && lifecycleName === LIFECYCLE_ACTIVATE) {\n          node.updateTime = Date.now();\n        }\n        var cached = lifecycleName === LIFECYCLE_UNACTIVATE;\n\n        // 若组件即将卸载则不再触发缓存生命周期\n        if (!cache || cache.willDrop) {\n          // 若组件在父 KeepAlive 缓存期间被卸载，后续恢复后需重新触发 init\n          if (_this.cached && !cached) {\n            _this.init();\n          }\n          return;\n        }\n        _run(cache, lifecycleName);\n        cache.cached = cached;\n        _this.cached = cached;\n      };\n    });\n    return _this;\n  }\n  _createClass(KeepAlive, [{\n    key: \"shouldComponentUpdate\",\n    value:\n    // 利用 shouldComponentUpdate 提前触发组件更新\n    function shouldComponentUpdate(nextProps) {\n      this.update(nextProps);\n      return false;\n    }\n\n    // 组件卸载时重置 dom 状态，保证 react dom 操作正常进行，并触发 unactivate 生命周期\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      var _this$props5 = this.props,\n        id = _this$props5.id,\n        _helpers = _this$props5._helpers,\n        _this$props5$when = _this$props5.when,\n        calcWhen = _this$props5$when === void 0 ? true : _this$props5$when;\n      var cache = _helpers.getCache(id);\n      var _parseWhenResult = parseWhenResult(_run(calcWhen)),\n        _parseWhenResult2 = _slicedToArray(_parseWhenResult, 2),\n        when = _parseWhenResult2[0],\n        isScope = _parseWhenResult2[1];\n      if (!cache) {\n        return;\n      }\n      this.eject();\n      delete cache.getInstance;\n      if (!when) {\n        if (isScope) {\n          var needToDrop = [cache].concat(_toConsumableArray(_helpers.getScopeIds([id]).map(function (id) {\n            return _helpers.getCache(id);\n          }))).filter(Boolean);\n          needToDrop.forEach(function (cache) {\n            cache.willDrop = true;\n          });\n          _nextTick(function () {\n            return _helpers.dropScopeByIds([id]);\n          });\n        } else {\n          cache.willDrop = true;\n          _nextTick(function () {\n            return _helpers.dropById(id);\n          });\n        }\n      }\n\n      // 触发 willUnactivate 生命周期\n      _run(this, LIFECYCLE_UNACTIVATE);\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n      return /*#__PURE__*/React__default.createElement(\"div\", {\n        key: \"keep-alive-placeholder\",\n        className: \"ka-wrapper\",\n        ref: function ref(node) {\n          _this2.placeholder = node;\n        }\n      });\n    }\n  }]);\n  return KeepAlive;\n}(React.Component); // 兼容 SSR 服务端渲染\n_defineProperty(KeepAlive, \"defaultProps\", {\n  saveScrollPosition: true\n});\nfunction SSRKeepAlive(_ref2) {\n  var children = _ref2.children;\n  return /*#__PURE__*/React__default.createElement(\"div\", {\n    key: \"keep-alive-placeholder\",\n    className: \"ka-wrapper\"\n  }, /*#__PURE__*/React__default.createElement(\"div\", {\n    key: \"keeper-container\",\n    className: \"ka-content\"\n  }, children));\n}\nvar KeepAlive$1 = _isFunction(_get(_globalThis, 'document.getElementById')) ? expandKeepAlive(withActivation(KeepAlive)) : SSRKeepAlive;\nexports.AliveScope = AliveScope;\nexports.KeepAlive = KeepAlive$1;\nexports.NodeKey = NodeKey;\nexports.autoFixContext = autoFixContext;\nexports.createContext = createContext;\nexports.default = KeepAlive$1;\nexports.fixContext = fixContext;\nexports.useActivate = useActivate;\nexports.useAliveController = useAliveController;\nexports.useUnactivate = useUnactivate;\nexports.withActivation = withActivation;\nexports.withAliveScope = withAliveScope;","map":{"version":3,"names":["isRegExp","val","RegExp","aliveScopeContext","createContext$1","AliveScopeProvider","Provider","AliveScopeConsumer","Consumer","aliveNodeContext","AliveNodeProvider","AliveNodeConsumer","eventBus","_EventBus","FakeScopeProvider","_Component","_inherits","_super","_createSuper","props","_this","_classCallCheck","call","currentContextValue","value","_createClass","key","shouldComponentUpdate","nextProps","emit","children","render","React","Component","_defineProperty","undefined","FakeScopeConsumer","_PureComponent","_super2","_this2","_assertThisInitialized","context","_debounce","nextContextValue","setState","on","updateListener","componentWillUnmount","off","state","_run","PureComponent","_filehash","useScopeContext","_isFunction","useContext","scopeReactContext","_useState","useState","_useState2","_slicedToArray","setContext","useEffect","AliveScopeProvider$1","_ref","_objectWithoutProperties","_excluded","React__default","createElement","_extends","_nk","concat","AliveScopeConsumer$1","_ref2","reactContext","_filehash$1","Suspender","_len","arguments","length","args","Array","_key","apply","_this$props","freeze","promiseCache","promise","Promise","resolve","Fragment","Freeze","_ref$placeholder","placeholder","Suspense","fallback","fixedContext","updateListenerCache","Map","eventBus$1","fixContext","_memoize","ctx","_isExist","includes","ctxValue","push","setTimeout","createContext","defaultValue","calculateChangedBits","tryFixCtx","type","_get","override","configs","forEach","_ref3","_toArray","host","methods","slice","method","originMethod","bind","_isString","_overridden","autoFixContext","_len2","_key2","err","console","warn","_filehash$2","ProviderBridge","ctxValues","_possibleConstructorReturn","_ctxValues","_ctxValues$","onUpdate","unmount","propCtxValues","filter","Boolean","_ctxValues2","restValues","nextChildren","_isUndefined","ConsumerWrapper","id","get","fn","ctxInfo","updator","set","_objectSpread2","prevValue","shouldUpdate","_this$props2","renderWrapper","renderContent","ctx$$","_toConsumableArray","_filehash$3","fixedContextSnapshot","RecursiveConsumerBridge","renderChildren","reduce","_id","_filehash$4","isSupported","lazy","SusNotSupported","Lazy","FallbackListener","componentDidMount","SuspenseBridge","sus$$","onStart","onSuspenseStart","onEnd","onSuspenseEnd","LazyBridge","_Component2","suspense","SuspenseBridge$1","ErrorBoundaryBridge","componentDidCatch","error","throwError","error$$","ErrorThrower","cb","_filehash$5","Bridge","bridgeProps","Acceptor","_filehash$6","LIFECYCLE_ACTIVATE","LIFECYCLE_UNACTIVATE","withActivation","WrappedComponent","HOC","drop","forwardedRef","_excluded$1","attach","ref","every","lifecycleName","_isObject","current","prototype","_componentDidMount","_this3","_nextTick","forwardRef","ForwardedRefHOC","hoistStatics","useActivation","funcName","func","useRef","some","_useRef","useActivate","useUnactivate","_filehash$7","Freeze$1","Keeper","rest","nextState","callback","unmounted","_listeners$set","listeners","isKeepAlive","store","cache","aliveNodesId","Set","_ref2$delay","delay","timeout","scope","clearTimeout","willDrop","nodes","helpers","smartForceUpdate","canDrop","canRefresh","safeSetState","Math","random","_this$cache","_this$props3","node","wrapper","has","e","inited","cached","_this$props4","keepers","appendChild","freezeTimeout","listener","reverse","_ref4","reactDom","flushSync","_this4","_this$props5","_this$props5$autoFree","autoFreeze","_excluded$2","_this$state","className","contextValue","Children","map","child","idx","cloneElement","_filehash$8","HANDLE_TYPE_DROP","HANDLE_TYPE_REFRESH","AliveScope","forceUpdate","updateCallbackList","debouncedForceUpdate","params","keeper","isNew","now","Date","createTime","updateTime","update","then","name","getCachingNodes","test","ids","getCachingNodesId","getCache","size","_flatten","handleNodes","_len3","_key3","getScopeIds","_len4","_key4","getCachingNodesByName","_this5","_len5","_key5","dropScopeByIds","_this6","_len6","_key6","_this7","_len7","_key7","_this8","_len8","_key8","_this9","_len9","_key9","refreshScopeByIds","nodesId","_len10","_key10","handleKeepers","all","responses","_this10","_len11","_key11","values","keep","dropScope","dropById","refresh","refreshScope","refreshById","clear","getNode","_this11","_this$props$children","style","display","_excluded$3","_filehash$9","controllerCherryPick","controller","expandKeepAlive","KeepAlive","idPrefix","isOutsideAliveScope","NodeKey","prefix","manualKey","cacheKey","nkId","_helpers","HookExpand","_excluded$4","WithExpand","_excluded2","withAliveScope","HookScope","_ref5","_excluded3","WithScope","_ref6","_excluded4","HOCWithAliveScope","useAliveController","isScrollableNode","scrollWidth","clientWidth","scrollHeight","clientHeight","getScrollableNodes","from","_globalThis","_value","saveScrollPosition","saver","x","scrollLeft","y","scrollTop","revert","_ref2$","body","screenScrollingElement","parseWhenResult","res","_isArray","didActivate","revertScrollPos","willUnactivate","nodesNeedToSaveScrollPosition","flag","removeChild","_excluded$5","getInstance","inject","_excluded2$1","init","_this$props5$when","when","calcWhen","_parseWhenResult","_parseWhenResult2","isScope","eject","needToDrop","SSRKeepAlive","KeepAlive$1"],"sources":["/media/starrynight/main_pt/projects_linux/blog_website/frontend/blog-website/node_modules/react-activation/src/helpers/is/index.js","/media/starrynight/main_pt/projects_linux/blog_website/frontend/blog-website/node_modules/react-activation/src/core/context/reactContext.js","/media/starrynight/main_pt/projects_linux/blog_website/frontend/blog-website/node_modules/react-activation/src/core/context/FakeScopeContext.js","/media/starrynight/main_pt/projects_linux/blog_website/frontend/blog-website/node_modules/react-activation/src/core/context/index.js","/media/starrynight/main_pt/projects_linux/blog_website/frontend/blog-website/node_modules/react-activation/src/core/Freeze.js","/media/starrynight/main_pt/projects_linux/blog_website/frontend/blog-website/node_modules/react-activation/src/core/Bridge/Context/fixContext.js","/media/starrynight/main_pt/projects_linux/blog_website/frontend/blog-website/node_modules/react-activation/src/core/Bridge/Context/ProviderBridge.js","/media/starrynight/main_pt/projects_linux/blog_website/frontend/blog-website/node_modules/react-activation/src/core/Bridge/Context/ConsumerWrapper.js","/media/starrynight/main_pt/projects_linux/blog_website/frontend/blog-website/node_modules/react-activation/src/core/Bridge/Context/ConsumerBridge.js","/media/starrynight/main_pt/projects_linux/blog_website/frontend/blog-website/node_modules/react-activation/src/core/Bridge/Suspense.js","/media/starrynight/main_pt/projects_linux/blog_website/frontend/blog-website/node_modules/react-activation/src/core/Bridge/ErrorBoundary.js","/media/starrynight/main_pt/projects_linux/blog_website/frontend/blog-website/node_modules/react-activation/src/core/Bridge/index.js","/media/starrynight/main_pt/projects_linux/blog_website/frontend/blog-website/node_modules/react-activation/src/core/lifecycles.js","/media/starrynight/main_pt/projects_linux/blog_website/frontend/blog-website/node_modules/react-activation/src/core/Keeper.js","/media/starrynight/main_pt/projects_linux/blog_website/frontend/blog-website/node_modules/react-activation/src/core/AliveScope.js","/media/starrynight/main_pt/projects_linux/blog_website/frontend/blog-website/node_modules/react-activation/src/core/withAliveScope.js","/media/starrynight/main_pt/projects_linux/blog_website/frontend/blog-website/node_modules/react-activation/src/helpers/saveScrollPosition.js","/media/starrynight/main_pt/projects_linux/blog_website/frontend/blog-website/node_modules/react-activation/src/core/KeepAlive.js"],"sourcesContent":["// 值类型判断 +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++\nexport const isRegExp = (val) => val instanceof RegExp\n// 值类型判断 -------------------------------------------------------------\n","import createContext from 'create-react-context'\n\n// 整个 KeepAlive 功能的上下文，将 KeepAlive 的组件藏于其 Provider 中，保证其不会被卸载\nexport const aliveScopeContext = createContext()\nexport const {\n  Provider: AliveScopeProvider,\n  Consumer: AliveScopeConsumer,\n} = aliveScopeContext\n\n// KeepAlive 组件的上下文，实现缓存生命周期功能\nexport const aliveNodeContext = createContext()\nexport const {\n  Provider: AliveNodeProvider,\n  Consumer: AliveNodeConsumer,\n} = aliveNodeContext\n","import { Component, PureComponent } from 'react'\nimport { EventBus, run, debounce } from 'szfe-tools'\n\nexport const eventBus = new EventBus()\n\nexport class FakeScopeProvider extends Component {\n  static eventBus = eventBus\n  static currentContextValue = undefined\n\n  constructor(props) {\n    super(props)\n    FakeScopeProvider.currentContextValue = props.value\n  }\n\n  shouldComponentUpdate(nextProps) {\n    if (nextProps.value !== this.props.value) {\n      FakeScopeProvider.currentContextValue = nextProps.value\n      eventBus.emit('update', nextProps.value)\n    }\n\n    return (\n      nextProps.children !== this.props.children ||\n      nextProps.value !== this.props.value\n    )\n  }\n\n  render() {\n    const { children } = this.props\n    return children\n  }\n}\n\nexport class FakeScopeConsumer extends PureComponent {\n  state = {\n    context: FakeScopeProvider.currentContextValue,\n  }\n\n  constructor(props) {\n    super(props)\n    eventBus.on('update', this.updateListener)\n  }\n\n  updateListener = debounce((nextContextValue) => {\n    this.setState({\n      context: nextContextValue,\n    })\n  })\n\n  componentWillUnmount() {\n    eventBus.off('update', this.updateListener)\n  }\n\n  render() {\n    const { children } = this.props\n    const { context } = this.state\n    return run(children, undefined, context)\n  }\n}\n","/* eslint-disable react-hooks/rules-of-hooks */\nimport React, { useState, useContext, useEffect } from 'react'\nimport { run, debounce, isFunction } from 'szfe-tools'\n\nimport {\n  aliveScopeContext,\n  AliveScopeProvider as AliveScopeReactProvider,\n  AliveScopeConsumer as AliveScopeReactConsumer,\n  aliveNodeContext,\n  AliveNodeProvider,\n  AliveNodeConsumer,\n} from './reactContext'\nimport {\n  eventBus as fakeContextEventBus,\n  FakeScopeProvider,\n  FakeScopeConsumer,\n} from './FakeScopeContext'\n\nexport const useScopeContext = () => {\n  if (!isFunction(useContext)) {\n    return {}\n  }\n\n  const scopeReactContext = useContext(aliveScopeContext)\n\n  if (scopeReactContext) {\n    return scopeReactContext\n  }\n\n  const [context, setContext] = useState(FakeScopeProvider.currentContextValue)\n\n  useEffect(() => {\n    const updateListener = debounce(setContext)\n    fakeContextEventBus.on('update', updateListener)\n    return () => fakeContextEventBus.off('update', updateListener)\n  }, [])\n\n  return context\n}\n\nexport const AliveScopeProvider = ({ children, ...props }) => (\n  <AliveScopeReactProvider {...props}>\n    <FakeScopeProvider {...props}>{children}</FakeScopeProvider>\n  </AliveScopeReactProvider>\n)\nexport const AliveScopeConsumer = ({ children }) => (\n  <AliveScopeReactConsumer>\n    {(reactContext) =>\n      !!reactContext ? (\n        run(children, undefined, reactContext)\n      ) : (\n        <FakeScopeConsumer>{children}</FakeScopeConsumer>\n      )\n    }\n  </AliveScopeReactConsumer>\n)\nexport {\n  aliveScopeContext,\n  aliveNodeContext,\n  AliveNodeProvider,\n  AliveNodeConsumer,\n}\n","// Fork from react-freeze\r\n// https://github.com/software-mansion/react-freeze/blob/main/src/index.tsx\r\nimport React, { Component, Suspense, Fragment } from 'react'\r\n\r\n// function Suspender({ freeze, children }) {\r\n//   const promiseCache = useRef({}).current\r\n//   if (freeze && !promiseCache.promise) {\r\n//     promiseCache.promise = new Promise((resolve) => {\r\n//       promiseCache.resolve = resolve\r\n//     })\r\n//     throw promiseCache.promise\r\n//   } else if (freeze) {\r\n//     throw promiseCache.promise\r\n//   } else if (promiseCache.promise) {\r\n//     promiseCache.resolve()\r\n//     promiseCache.promise = undefined\r\n//   }\r\n\r\n//   return <Fragment>{children}</Fragment>\r\n// }\r\n\r\nclass Suspender extends Component {\r\n  promiseCache = {}\r\n  render() {\r\n    const { freeze, children } = this.props\r\n    const { promiseCache } = this\r\n\r\n    if (freeze && !promiseCache.promise) {\r\n      promiseCache.promise = new Promise((resolve) => {\r\n        promiseCache.resolve = resolve\r\n      })\r\n      throw promiseCache.promise\r\n    } else if (freeze) {\r\n      throw promiseCache.promise\r\n    } else if (promiseCache.promise) {\r\n      promiseCache.resolve()\r\n      promiseCache.promise = undefined\r\n    }\r\n\r\n    return <Fragment>{children}</Fragment>\r\n  }\r\n}\r\n\r\nexport default function Freeze({ freeze, children, placeholder = null }) {\r\n  return (\r\n    <Suspense fallback={placeholder}>\r\n      <Suspender freeze={freeze}>{children}</Suspender>\r\n    </Suspense>\r\n  )\r\n}","import React, { useContext, Fragment } from 'react'\nimport createReactContext from 'create-react-context'\nimport { run, get, isString, isFunction, memoize, EventBus, isExist } from 'szfe-tools'\n\nimport { aliveScopeContext, aliveNodeContext } from '../../context'\n\nexport const fixedContext = []\nexport const updateListenerCache = new Map()\nexport const eventBus = new EventBus()\n\nexport const fixContext = memoize((ctx) => {\n  if (!isExist(ctx)) {\n    return\n  }\n\n  // 排除 KeepAlive 功能的上下文\n  if ([aliveScopeContext, aliveNodeContext].includes(ctx)) {\n    return\n  }\n\n  // #259: 结合 use-context-selector 时，修复被删除的 Consumer\n  if (!isExist(ctx.Consumer)) {\n    function Consumer({ children }) {\n      const ctxValue = run(useContext, undefined, ctx)\n    \n      return <Fragment>{run(children, undefined, ctxValue)}</Fragment>\n    }\n    \n    // 重新声明 Consumer\n    ctx.Consumer = Consumer\n  }\n\n  fixedContext.push(ctx)\n  setTimeout(() => eventBus.emit('update'))\n})\n\nexport const createContext = (defaultValue, calculateChangedBits) => {\n  const ctx = createReactContext(defaultValue, calculateChangedBits)\n\n  fixContext(ctx)\n  return ctx\n}\n\nconst tryFixCtx = memoize((type) => {\n  // 尝试读取 Provider 或 Consumer 中的 context 静态属性\n  const ctx = get(type, '_context') || get(type, 'context') // 16.3.0 版本为 context，之后为 _context\n\n  // 判断是否为 ReactContext 类型\n  if (get(ctx, '$$typeof') === get(aliveScopeContext, '$$typeof')) {\n    fixContext(ctx)\n  }\n})\n\nconst override = (configs) => {\n  configs.forEach(([host, ...methods]) => {\n    methods.forEach((method) => {\n      if (\n        !isFunction(get(host, method)) ||\n        get(host, [method, '_overridden'])\n      ) {\n        return\n      }\n      const originMethod = host[method].bind(host)\n      host[method] = (type, ...args) => {\n        if (!isString(type)) {\n          tryFixCtx(type)\n        }\n        return originMethod(type, ...args)\n      }\n      host[method]._overridden = true\n    })\n  })\n}\n\n/**\n * 通过覆写 React.createElement 方法来探测 Provider 或 Consumer 的创建，并攫取其中 context 主动进行修复\n * TODO：同时兼容 React 17+，目前仅默认兼容 React.createElement 方法\n * React 17+ 为 require('react/jsx-runtime') 或 require('react/jsx-dev-runtime') 的 jsx、jsxs、jsxDEV 方法\n * 但由于无法动态 require，暂未想到方式同时兼容\n * 若需兼容 17+，目前手法为\n *\n * autoFixContext(\n *   [require('react/jsx-runtime'), 'jsx', 'jsxs', 'jsxDEV'],\n *   [require('react/jsx-dev-runtime'), 'jsx', 'jsxs', 'jsxDEV']\n * )\n *\n * Note: 需注意 16.2.x 及以下版本不支持此方法\n */\nexport const autoFixContext = (...configs) => {\n  try {\n    override(configs)\n  } catch (err) {\n    console.warn('activation override failed:', err)\n  }\n}\n\nautoFixContext([React, 'createElement'])\n","import React, { PureComponent } from 'react'\nimport { run, isUndefined } from 'szfe-tools'\n\nexport default class ProviderBridge extends PureComponent {\n  unmount = null\n  constructor(props) {\n    super(props)\n\n    const { value: ctxValues } = props\n\n    if (ctxValues.length === 0) {\n      this.state = {\n        ctxValue: null,\n      }\n\n      return\n    }\n\n    const [{ ctx, value, onUpdate }] = ctxValues\n\n    this.state = {\n      ctxValue: value,\n    }\n\n    this.unmount = onUpdate((value) => {\n      this.setState({\n        ctxValue: value,\n      })\n    })\n  }\n\n  componentWillUnmount() {\n    run(this.unmount)\n  }\n\n  // componentDidCatch(error) {\n  //   console.error('ProviderBridge Error', error)\n  // }\n\n  render() {\n    const { value: propCtxValues, children } = this.props\n    const ctxValues = propCtxValues.filter(Boolean)\n\n    if (ctxValues.length === 0) {\n      return children\n    }\n\n    const { ctxValue } = this.state\n    const [{ ctx }, ...restValues] = ctxValues\n    const { Provider } = ctx\n\n    const nextChildren = !isUndefined(ctxValue) ? (\n      <Provider value={ctxValue}>{children}</Provider>\n    ) : (\n      children\n    )\n\n    // 递归 ProviderBridge 修复多个上下文\n    // 此处未考虑待修复上下文顺序问题，按先来后到顺序处理，但理论上不应存在顺序问题\n    return restValues.length > 0 ? (\n      <ProviderBridge value={restValues}>{nextChildren}</ProviderBridge>\n    ) : (\n      nextChildren\n    )\n  }\n}\n","import { Component } from 'react'\nimport { run, get, isUndefined } from 'szfe-tools'\n\nimport { updateListenerCache } from './fixContext'\n\n// 在 KeepAlive 位置使用待修复上下文的 Consumer 探测可能存在的上下文关系\n// 若成功捕获上下文则保存其内容，用以后续 Keeper 中上下文的重建\nexport default class ConsumerWrapper extends Component {\n  updateListener = null\n  ctxInfo = null\n  constructor(props) {\n    super(props)\n\n    const { value, ctx, id } = props\n    if (isUndefined(value)) {\n      return\n    }\n\n    // 因 Consumer 探测器存在于 KeepAlive 外层故会随着 KeepAlive 卸载\n    // componentWillUnmount 中保留了已生成的更新监听器\n    // 此处重新挂载后恢复与对应 Keeper 中 ProviderBridge 的联系\n    this.updateListener = get(updateListenerCache.get(ctx), id, new Map())\n    run(this.updateListener, 'forEach', (fn) => fn(value))\n    this.ctxInfo = {\n      ctx,\n      value,\n      // 注册上下文更新的监听，保证上下文更新时 Keeper 中 ProviderBridge 内容的同步\n      onUpdate: (updator) => {\n        this.updateListener.set(updator, updator)\n\n        // 返回更新监听器的注销方法\n        return () => this.updateListener.delete(updator)\n      },\n    }\n  }\n\n  componentWillUnmount() {\n    const { value, ctx, id } = this.props\n    if (isUndefined(value)) {\n      return\n    }\n\n    // 因 Consumer 探测器存在于 KeepAlive 外层故会随着 KeepAlive 卸载\n    // 此处保留其中已生成的更新监听器，用以在重新挂载后保持与对应 Keeper 中 ProviderBridge 的联系\n    updateListenerCache.set(ctx, {\n      ...get(updateListenerCache.get(ctx), undefined, {}),\n      [id]: this.updateListener,\n    })\n  }\n\n  // 利用 shouldComponentUpdate 尽早将上下文更新的咨询通知到对应 Keeper 中 ProviderBridge\n  // TODO: 改用 componentWillReceiveProps 更早地进行更新，需注意与 getDerivedStateFromProps 新生命周期的兼容及可能存在的死循环问题\n  shouldComponentUpdate({ value }) {\n    const { value: prevValue } = this.props\n    const shouldUpdate = prevValue !== value\n\n    if (shouldUpdate) {\n      run(this.updateListener, 'forEach', (fn) => fn(value))\n    }\n\n    return true\n  }\n\n  render() {\n    const { value, renderWrapper, renderContent, id } = this.props\n\n    return renderWrapper((ctx$$) =>\n      renderContent(isUndefined(value) ? ctx$$ : [...ctx$$, this.ctxInfo])\n    )\n  }\n}\n","/* eslint-disable react-hooks/rules-of-hooks */\nimport React, {\n  PureComponent,\n  useContext,\n  useRef,\n  useEffect,\n  useState,\n} from 'react'\nimport { run, get, nextTick, isUndefined, isFunction, isExist } from 'szfe-tools'\n\nimport ConsumerWrapper from './ConsumerWrapper'\nimport { fixedContext, eventBus, updateListenerCache } from './fixContext'\n\nconst fixedContextSnapshot = {}\n\n// 对 ConsumerWrapper 的递归结构，会在 devtool 中生成较深的嵌套结构，可用 hooks 消除嵌套结构\nclass RecursiveConsumerBridge extends PureComponent {\n  constructor(props) {\n    super(props)\n    const { id } = props\n\n    if (!fixedContextSnapshot[id]) {\n      fixedContextSnapshot[id] = [...fixedContext].filter(ctx => isExist(ctx.Consumer))\n    }\n  }\n\n  renderWrapper = (renderChildren) => {\n    const { id } = this.props\n\n    const renderWrapper = fixedContextSnapshot[id].reduce(\n      (render, ctx) => {\n        const { Consumer } = ctx\n\n        const renderWrapper = (renderContent) => (\n          <Consumer>\n            {(value) => (\n              <ConsumerWrapper\n                {...{\n                  value,\n                  ctx,\n                  renderWrapper: render,\n                  renderContent,\n                  id,\n                }}\n              />\n            )}\n          </Consumer>\n        )\n\n        return renderWrapper\n      },\n      (renderContent) => renderContent([])\n    )\n\n    return renderWrapper(renderChildren)\n  }\n\n  render() {\n    const { children: renderChildren } = this.props\n\n    return this.renderWrapper(renderChildren)\n  }\n}\n\n// 若支持 Hooks，就不需要递归了，相关实现解释可参考 ConsumerWrapper\n// function HooksConsumerBridge({ children: renderChildren, id }) {\n//   const [, setRenderKey] = useState(Math.random)\n\n//   useEffect(() => {\n//     // 渲染时若 fixedContext 列表更新，则需强制刷新\n//     const updateListener = () => setRenderKey(Math.random)\n//     eventBus.on('update', updateListener)\n//     return () => {\n//       eventBus.off('update', updateListener)\n//     }\n//   }, [])\n\n//   const context$$ = fixedContext\n//     .map((ctx) => {\n//       const value = useContext(ctx)\n//       const prevValueRef = useRef(value)\n//       const { current: updateListener } = useRef(\n//         get(updateListenerCache.get(ctx), id, new Map())\n//       )\n\n//       // 尽可能早地进行更新\n//       if (prevValueRef.current !== value) {\n//         nextTick(() => run(updateListener, 'forEach', (fn) => fn(value)))\n//       }\n//       prevValueRef.current = value\n\n//       useEffect(() => {\n//         return () => {\n//           if (isUndefined(value)) {\n//             return\n//           }\n\n//           updateListenerCache.set(ctx, {\n//             ...get(updateListenerCache.get(ctx), undefined, {}),\n//             [id]: updateListener,\n//           })\n//         }\n//       }, [])\n\n//       return {\n//         ctx,\n//         value,\n//         onUpdate: (fn) => {\n//           updateListener.set(fn, fn)\n\n//           return () => updateListener.delete(fn)\n//         },\n//       }\n//     })\n//     .filter(({ value }) => !isUndefined(value))\n\n//   return renderChildren(context$$)\n// }\n\n// fix #99\n// const ConsumerBridge = [useContext, useRef, useEffect].every(isFunction)\n//   ? HooksConsumerBridge\n//   : RecursiveConsumerBridge\n// fix #99\nexport default RecursiveConsumerBridge\n","import React, { lazy, Suspense, Component, Fragment } from 'react'\nimport { run, isUndefined, isFunction } from 'szfe-tools'\n\n// 兼容性检测\nconst isSupported = isFunction(lazy) && !isUndefined(Suspense)\nconst SusNotSupported = ({ children }) => run(children)\n\nconst Lazy = isSupported ? lazy(() => new Promise(() => null)) : () => null\n\nclass FallbackListener extends Component {\n  componentDidMount() {\n    run(this.props, 'onStart')\n  }\n\n  componentWillUnmount() {\n    run(this.props, 'onEnd')\n  }\n\n  render() {\n    return null\n  }\n}\n\nfunction SuspenseBridge({ children, sus$$ }) {\n  return (\n    // 捕获 Keeper 内部可能存在的 lazy，并触发对应 KeepAlive 位置上的 LazyBridge\n    <Suspense\n      fallback={\n        <FallbackListener\n          onStart={sus$$.onSuspenseStart}\n          onEnd={sus$$.onSuspenseEnd}\n        />\n      }\n    >\n      {children}\n    </Suspense>\n  )\n}\n\nexport const LazyBridge = isSupported\n  ? class LazyBridge extends Component {\n      state = {\n        suspense: false,\n      }\n\n      onSuspenseStart = () => {\n        this.setState({\n          suspense: true,\n        })\n      }\n\n      onSuspenseEnd = () => {\n        this.setState({\n          suspense: false,\n        })\n      }\n\n      sus$$ = {\n        onSuspenseStart: this.onSuspenseStart,\n        onSuspenseEnd: this.onSuspenseEnd,\n      }\n\n      render() {\n        const { children } = this.props\n\n        return (\n          <Fragment>\n            {run(children, undefined, this.sus$$)}\n            {/* 渲染 Lazy 以触发 KeepAlive 所处位置外部可能存在的 Suspense */}\n            {this.state.suspense && <Lazy />}\n          </Fragment>\n        )\n      }\n    }\n  : SusNotSupported\n\nexport default isSupported ? SuspenseBridge : SusNotSupported\n","import { Component } from 'react'\nimport { run } from 'szfe-tools'\n\nexport default class ErrorBoundaryBridge extends Component {\n  // Error Boundary 透传至对应 KeepAlive 实例位置\n  static getDerivedStateFromError = () => null\n  componentDidCatch(error) {\n    const { error$$: throwError } = this.props\n\n    run(throwError, undefined, error, () => {\n      run(throwError, undefined, null)\n    })\n  }\n\n  render() {\n    return this.props.children\n  }\n}\n\nexport class ErrorThrower extends Component {\n  state = {\n    error: null,\n  }\n\n  throwError = (error, cb) => this.setState({ error }, cb)\n  render() {\n    if (this.state.error) {\n      throw this.state.error\n    }\n\n    return run(this.props.children, undefined, this.throwError)\n  }\n}\n","import React from 'react'\nimport { run } from 'szfe-tools'\n\nimport { ProviderBridge, ConsumerBridge } from './Context'\nimport SuspenseBridge, { LazyBridge } from './Suspense'\nimport ErrorBoundaryBridge, { ErrorThrower } from './ErrorBoundary'\n\n// 用于 Keeper 中，实现 Keeper 向外或向内的桥接代理\nexport default function Bridge({ id, children, bridgeProps }) {\n  const { sus$$, ctx$$, error$$ } = bridgeProps\n\n  return (\n    /* 由内向外透传 componentDidCatch 捕获的 error */\n    <ErrorBoundaryBridge error$$={error$$}>\n      {/* 由内向外透传 lazy 行为 */}\n      <SuspenseBridge sus$$={sus$$}>\n        {/* 由外向内透传可能存在的 Consumer 数据 */}\n        <ProviderBridge id={id} value={ctx$$}>\n          {children}\n        </ProviderBridge>\n      </SuspenseBridge>\n    </ErrorBoundaryBridge>\n  )\n}\n\n// 用于 KeepAlive 中，实现 KeepAlive 向外或向内的桥接代理\nexport function Acceptor({ id, children }) {\n  return (\n    /* 由内向外透传 componentDidCatch 捕获的 error */\n    <ErrorThrower>\n      {(error$$) => (\n        /* 由内向外透传 lazy 行为 */\n        <LazyBridge>\n          {(sus$$) => (\n            /* 由外向内透传可能被捕获的 Provider 数据 */\n            <ConsumerBridge id={id}>\n              {(ctx$$) =>\n                run(children, undefined, {\n                  bridgeProps: {\n                    sus$$,\n                    ctx$$,\n                    error$$,\n                  },\n                })\n              }\n            </ConsumerBridge>\n          )}\n        </LazyBridge>\n      )}\n    </ErrorThrower>\n  )\n}\n","/* eslint-disable react-hooks/rules-of-hooks */\nimport React, {\n  Component,\n  forwardRef,\n  useEffect,\n  useRef,\n  useContext,\n} from 'react'\nimport hoistStatics from 'hoist-non-react-statics'\nimport {\n  get,\n  run,\n  nextTick,\n  isObject,\n  isFunction,\n  isUndefined,\n} from 'szfe-tools'\n\nimport { AliveNodeConsumer, aliveNodeContext } from './context'\n\nexport const LIFECYCLE_ACTIVATE = 'componentDidActivate'\nexport const LIFECYCLE_UNACTIVATE = 'componentWillUnactivate'\n\nexport const withActivation = (WrappedComponent) => {\n  class HOC extends Component {\n    drop = null\n\n    componentWillUnmount() {\n      run(this.drop)\n    }\n\n    render() {\n      const { forwardedRef, ...props } = this.props\n\n      return (\n        <AliveNodeConsumer>\n          {({ attach } = {}) => (\n            <WrappedComponent\n              ref={(ref) => {\n                if (\n                  [LIFECYCLE_ACTIVATE, LIFECYCLE_UNACTIVATE].every(\n                    (lifecycleName) => !isFunction(get(ref, lifecycleName))\n                  )\n                ) {\n                  return\n                }\n                this.drop = run(attach, undefined, ref)\n\n                // 以下保持 ref 功能\n                if (isUndefined(forwardedRef)) {\n                  return\n                }\n\n                if (isObject(forwardedRef) && 'current' in forwardedRef) {\n                  forwardedRef.current = ref\n                  return\n                }\n\n                run(forwardedRef, undefined, ref)\n              }}\n              {...props}\n            />\n          )}\n        </AliveNodeConsumer>\n      )\n    }\n  }\n\n  // 由于 KeepAlive 内组件渲染与实际内容落后一个节拍\n  // 将导致真实节点的 componentDidMount 无法及时获取到 KeepAlive 中内容的 ref 值\n  // 此处对使用了 withActivation HOC 的组件 componentDidMount 做 nextTick 延时处理\n  // 修复上述问题\n\n  if (isFunction(WrappedComponent.prototype.componentDidMount)) {\n    WrappedComponent.prototype._componentDidMount =\n      WrappedComponent.prototype.componentDidMount\n    WrappedComponent.prototype.componentDidMount = function componentDidMount() {\n      nextTick(() => WrappedComponent.prototype._componentDidMount.call(this))\n    }\n  }\n\n  if (isFunction(forwardRef)) {\n    const ForwardedRefHOC = forwardRef((props, ref) => (\n      <HOC {...props} forwardedRef={ref} />\n    ))\n\n    return hoistStatics(ForwardedRefHOC, WrappedComponent)\n  } else {\n    return hoistStatics(HOC, WrappedComponent)\n  }\n}\n\nconst useActivation = (funcName, func) => {\n  // 兼容性判断\n  if ([useRef, useContext, useEffect].some((fn) => !isFunction(fn))) {\n    return\n  }\n\n  const ctxValue = useContext(aliveNodeContext)\n\n  // 未处于 KeepAlive 中\n  if (!ctxValue) {\n    return\n  }\n\n  const { current: ref } = useRef({})\n  const { attach } = ctxValue\n\n  ref[funcName] = func\n  ref.drop = attach(ref)\n\n  useEffect(() => {\n    return () => run(ref.drop)\n  }, [])\n}\n\nexport const useActivate = useActivation.bind(null, LIFECYCLE_ACTIVATE)\nexport const useUnactivate = useActivation.bind(null, LIFECYCLE_UNACTIVATE)\n","import React, { PureComponent, Suspense } from 'react'\nimport { flushSync } from 'react-dom'\nimport { get, run, nextTick, EventBus } from 'szfe-tools'\n\nimport ReactFreeze from './Freeze'\nimport Bridge from './Bridge'\nimport { AliveNodeProvider } from './context'\nimport { LIFECYCLE_ACTIVATE, LIFECYCLE_UNACTIVATE } from './lifecycles'\n\nconst Freeze = !!Suspense ? ReactFreeze : ({ children }) => children\n\nexport default class Keeper extends PureComponent {\n  eventBus = new EventBus()\n  listeners = new Map()\n  wrapper = null\n\n  constructor(props, ...rest) {\n    super(props, ...rest)\n\n    this.state = {\n      children: props.children,\n      bridgeProps: props.bridgeProps,\n      key: Math.random(),\n      freeze: false,\n    }\n  }\n\n  cache = undefined\n  componentDidMount() {\n    const { store, id } = this.props\n    const listeners = this.listeners\n    const node = this.wrapper\n\n    // 已存在检测，防止意外现象\n    if (store.has(id)) {\n      return\n    }\n\n    let nodes\n    try {\n      nodes = [...node.children]\n    } catch (e) {\n      nodes = [node.children]\n    }\n\n    this.cache = {\n      listeners,\n      aliveNodesId: [],\n      inited: false,\n      cached: false,\n      wrapper: node,\n      nodes,\n      [LIFECYCLE_ACTIVATE]: () => this[LIFECYCLE_ACTIVATE](),\n      [LIFECYCLE_UNACTIVATE]: () => this[LIFECYCLE_UNACTIVATE](),\n    }\n\n    store.set(id, this.cache)\n  }\n\n  \n  unmounted = false\n  safeSetState = (nextState, callback) => {\n    // fix #170\n    if (this.unmounted) {\n      return\n    }\n    this.setState(nextState, callback)\n  }\n  componentWillUnmount() {\n    const { store, keepers, id } = this.props\n    // 卸载前尝试归位 DOM 节点\n    try {\n      const cache = store.get(id)\n      cache.nodes.forEach((node) => {\n        cache.wrapper.appendChild(node)\n      })\n    } catch (error) {\n      // console.error(error) // do nothing\n    }\n    store.delete(id)\n    keepers.delete(id)\n    this.unmounted = true\n  }\n\n  freezeTimeout = null\n\n  ;[LIFECYCLE_ACTIVATE]() {\n    clearTimeout(this.freezeTimeout)\n    // 激活后，立即解冻\n    this.safeSetState({\n      freeze: false,\n    })\n    this.eventBus.emit(LIFECYCLE_ACTIVATE)\n    this.listeners.forEach((listener) => run(listener, [LIFECYCLE_ACTIVATE]))\n  }\n\n  ;[LIFECYCLE_UNACTIVATE]() {\n    this.eventBus.emit(LIFECYCLE_UNACTIVATE)\n    const listeners = [...this.listeners]\n\n    listeners\n      .reverse()\n      .forEach(([, listener]) => run(listener, [LIFECYCLE_UNACTIVATE]))\n\n    // 缓存后，延迟冻结，保证各项后续处理得以进行，如关闭弹窗等\n    clearTimeout(this.freezeTimeout)\n    this.freezeTimeout = setTimeout(() => {\n      flushSync(() => {\n        this.safeSetState({\n          freeze: true,\n        })\n      })\n    }, 1000)\n  }\n\n  // // 原先打算更新过程中先重置 dom 节点状态，更新后恢复 dom 节点\n  // // 但考虑到性能消耗可能过大，且可能因 dom 操作时机引发其他 react 渲染问题，故不使用\n  // // 对应 KeepAlive 处 update 也注释起来不使用\n  // // 组件更新后，更新 DOM 节点列表状态\n  // componentDidUpdate() {\n  //   const { store, id } = this.props\n  //   const node = this.wrapper\n  //   if (get(node, 'children.length') > 0) {\n  //     store[id].nodes = [...node.children]\n  //   }\n\n  //   console.log(store[id].nodes)\n  // }\n\n  // 生命周期绑定\n  attach = (ref) => {\n    const listeners = this.listeners\n\n    if (!ref) {\n      return () => null\n    }\n\n    if (ref.isKeepAlive) {\n      nextTick(() => {\n        const { id, store } = this.props\n        const cache = store.get(id)\n        cache.aliveNodesId = new Set([...cache.aliveNodesId, ref.id])\n      })\n    }\n\n    listeners.set(ref, {\n      [LIFECYCLE_ACTIVATE]: () => run(ref, LIFECYCLE_ACTIVATE),\n      [LIFECYCLE_UNACTIVATE]: () => run(ref, LIFECYCLE_UNACTIVATE),\n    })\n\n    // 返回 listenerRemover 用以在对应组件卸载时解除监听\n    return () => {\n      listeners.delete(ref)\n    }\n  }\n\n  // 静态化节点上下文内容，防止重复渲染\n  contextValue = {\n    id: this.props.id,\n    attach: this.attach,\n  }\n\n  drop = ({ delay = 1200 } = {}) =>\n    new Promise((resolve) => {\n      let timeout\n      const { scope, id } = this.props\n      const drop = () => {\n        clearTimeout(timeout)\n        this.eventBus.off(LIFECYCLE_UNACTIVATE, drop)\n        // 用在多层 KeepAlive 同时触发 drop 时，避免触发深层 KeepAlive 节点的缓存生命周期\n        this.cache.willDrop = true\n        scope.nodes.delete(id)\n        scope.helpers = { ...scope.helpers }\n        scope.smartForceUpdate(() => resolve(true))\n      }\n\n      const canDrop = get(this.cache, 'cached') || get(this.cache, 'willDrop')\n      if (!canDrop) {\n        this.eventBus.on(LIFECYCLE_UNACTIVATE, drop)\n        timeout = setTimeout(() => {\n          this.eventBus.off(LIFECYCLE_UNACTIVATE, drop)\n          resolve(false)\n        }, delay)\n        return\n      }\n\n      drop()\n    })\n\n  refresh = () =>\n    new Promise((resolve) => {\n      const canRefresh = !get(this.cache, 'cached')\n      if (!canRefresh) {\n        resolve(false)\n      }\n      this.safeSetState(\n        {\n          key: Math.random(),\n        },\n        () => resolve(true)\n      )\n    })\n\n  render() {\n    const { id, autoFreeze = true, ...props } = this.props\n    const { children, bridgeProps, key, freeze } = this.state\n\n    return (\n      <Freeze freeze={autoFreeze && freeze}>\n        <div\n          ref={(node) => {\n            this.wrapper = node\n          }}\n        >\n          <div key=\"keeper-container\" nodeKeyIgnore className=\"ka-content\">\n            <Bridge id={id} bridgeProps={bridgeProps}>\n              <AliveNodeProvider value={this.contextValue}>\n                {React.Children.map(children, (child, idx) =>\n                  React.cloneElement(child, {\n                    key: `${child.key || ''}:${key}:${idx}`,\n                  })\n                )}\n              </AliveNodeProvider>\n            </Bridge>\n          </div>\n        </div>\n      </Freeze>\n    )\n  }\n}\n","import React, { Component } from 'react'\nimport { get, run, flatten, debounce, globalThis as root } from 'szfe-tools'\n\nimport { isRegExp } from '../helpers/is'\nimport { AliveScopeProvider } from './context'\nimport Keeper from './Keeper'\n\nconst HANDLE_TYPE_DROP = 'drop'\nconst HANDLE_TYPE_REFRESH = 'refresh'\n\nexport default class AliveScope extends Component {\n  store = new Map()\n  nodes = new Map()\n  keepers = new Map()\n\n  debouncedForceUpdate = debounce((cb) => this.forceUpdate(cb))\n  updateCallbackList = []\n  smartForceUpdate = (cb) => {\n    this.updateCallbackList.push(cb)\n    this.debouncedForceUpdate(() => {\n      this.updateCallbackList.forEach((cb) => run(cb))\n      this.updateCallbackList = []\n    })\n  }\n  update = (id, params) =>\n    new Promise((resolve) => {\n      const keeper = this.keepers.get(id)\n      const isNew = !keeper\n      const now = Date.now()\n      const node = this.nodes.get(id) || null\n      this.nodes.set(id, {\n        id,\n        createTime: now,\n        updateTime: now,\n        ...node,\n        ...params,\n      })\n\n      if (isNew) {\n        this.helpers = { ...this.helpers }\n\n        this.forceUpdate(resolve)\n      } else {\n        const { children, bridgeProps } = params\n        keeper.setState({ children, bridgeProps }, resolve)\n      }\n    })\n\n  keep = (id, params) =>\n    new Promise((resolve) => {\n      this.update(id, {\n        id,\n        ...params,\n      }).then(() => {\n        resolve(this.store.get(id))\n      })\n    })\n\n  getCachingNodesByName = (name) =>\n    this.getCachingNodes().filter((node) =>\n      isRegExp(name) ? name.test(node.name) : node.name === name\n    )\n\n  getScopeIds = (ids) => {\n    // 递归采集 scope alive nodes id\n    const getCachingNodesId = (id) => {\n      const aliveNodesId = get(this.getCache(id), 'aliveNodesId', [])\n\n      if (aliveNodesId.size > 0) {\n        return [id, [...aliveNodesId].map(getCachingNodesId)]\n      }\n\n      return [id, ...aliveNodesId]\n    }\n\n    return flatten(ids.map((id) => getCachingNodesId(id)))\n  }\n\n  dropById = (id, ...rest) => this.handleNodes([id], HANDLE_TYPE_DROP, ...rest)\n  dropScopeByIds = (ids, ...rest) =>\n    this.handleNodes(this.getScopeIds(ids), HANDLE_TYPE_DROP, ...rest)\n\n  drop = (name, ...rest) =>\n    this.handleNodes(\n      this.getCachingNodesByName(name).map((node) => node.id),\n      HANDLE_TYPE_DROP,\n      ...rest\n    )\n\n  dropScope = (name, ...rest) =>\n    this.dropScopeByIds(\n      this.getCachingNodesByName(name).map(({ id }) => id),\n      ...rest\n    )\n\n  refreshById = (id, ...rest) =>\n    this.handleNodes([id], HANDLE_TYPE_REFRESH, ...rest)\n  refreshScopeByIds = (ids, ...rest) =>\n    this.handleNodes(this.getScopeIds(ids), HANDLE_TYPE_REFRESH, ...rest)\n\n  refresh = (name, ...rest) =>\n    this.handleNodes(\n      this.getCachingNodesByName(name).map((node) => node.id),\n      HANDLE_TYPE_REFRESH,\n      ...rest\n    )\n\n  refreshScope = (name, ...rest) =>\n    this.refreshScopeByIds(\n      this.getCachingNodesByName(name).map(({ id }) => id),\n      ...rest\n    )\n\n  handleNodes = (nodesId, type = HANDLE_TYPE_DROP, ...rest) =>\n    new Promise((resolve) => {\n      const handleKeepers = []\n\n      nodesId.forEach((id) => {\n        const cache = this.store.get(id)\n\n        if (!cache) {\n          return\n        }\n\n        const keeper = this.keepers.get(id)\n        handleKeepers.push(keeper)\n      })\n\n      if (handleKeepers.length === 0) {\n        resolve(false)\n        return\n      }\n\n      Promise.all(\n        handleKeepers.map((keeper) => run(keeper, type, ...rest))\n      ).then((responses) => resolve(responses.every(Boolean)))\n    })\n\n  clear = (...rest) =>\n    this.handleNodes(\n      this.getCachingNodes().map(({ id }) => id),\n      HANDLE_TYPE_DROP,\n      ...rest\n    )\n\n  getCache = (id) => this.store.get(id)\n  getNode = (id) => this.nodes.get(id)\n  getCachingNodes = () => [...this.nodes.values()]\n\n  // 静态化节点上下文内容，防止重复渲染\n  helpers = {\n    keep: this.keep,\n    update: this.update,\n    drop: this.drop,\n    dropScope: this.dropScope,\n    dropById: this.dropById,\n    dropScopeByIds: this.dropScopeByIds,\n    refresh: this.refresh,\n    refreshScope: this.refreshScope,\n    refreshById: this.refreshById,\n    refreshScopeByIds: this.refreshScopeByIds,\n    getScopeIds: this.getScopeIds,\n    clear: this.clear,\n    getCache: this.getCache,\n    getNode: this.getNode,\n    getCachingNodes: this.getCachingNodes,\n  }\n\n  render() {\n    const { children = null } = this.props\n\n    return (\n      <AliveScopeProvider value={this.helpers}>\n        {children}\n        <div style={{ display: 'none' }}>\n          {[...this.nodes.values()].map(({ children, ...props }) => (\n            <Keeper\n              key={props.id}\n              {...props}\n              scope={this}\n              store={this.store}\n              keepers={this.keepers}\n              ref={(keeper) => {\n                this.keepers.set(props.id, keeper)\n              }}\n            >\n              {children}\n            </Keeper>\n          ))}\n        </div>\n      </AliveScopeProvider>\n    )\n  }\n}\n","/* eslint-disable react-hooks/rules-of-hooks */\nimport React, { forwardRef, useContext } from 'react'\nimport hoistStatics from 'hoist-non-react-statics'\nimport { get, isFunction, isUndefined } from 'szfe-tools'\n\nimport { Acceptor } from './Bridge'\nimport NodeKey from './NodeKey'\nimport { AliveScopeConsumer, useScopeContext } from './context'\n\nfunction controllerCherryPick(controller) {\n  const {\n    drop,\n    dropScope,\n    refresh,\n    refreshScope,\n    clear,\n    getCachingNodes,\n  } = controller\n  return { drop, dropScope, refresh, refreshScope, clear, getCachingNodes }\n}\n\nexport const expandKeepAlive = (KeepAlive) => {\n  const renderContent = ({ idPrefix, helpers, props }) => {\n    const isOutsideAliveScope = isUndefined(helpers)\n\n    if (isOutsideAliveScope) {\n      console.error('You should not use <KeepAlive /> outside a <AliveScope>')\n    }\n\n    return isOutsideAliveScope ? (\n      get(props, 'children', null)\n    ) : (\n      <NodeKey prefix={idPrefix} key={props._nk} manualKey={props.cacheKey}>\n        {(nkId) => {\n          const id = props.cacheKey || nkId\n\n          return (\n            <Acceptor key={id} id={id}>\n              {(bridgeProps) => (\n                <KeepAlive\n                  key={id}\n                  {...props}\n                  {...bridgeProps}\n                  id={id}\n                  _helpers={helpers}\n                />\n              )}\n            </Acceptor>\n          )\n        }}\n      </NodeKey>\n    )\n  }\n  const HookExpand = ({ id: idPrefix, ...props }) =>\n    renderContent({ idPrefix, helpers: useScopeContext(), props })\n\n  const WithExpand = ({ id: idPrefix, ...props }) => (\n    <AliveScopeConsumer>\n      {(helpers) => renderContent({ idPrefix, helpers, props })}\n    </AliveScopeConsumer>\n  )\n\n  return isFunction(useContext) ? HookExpand : WithExpand\n}\n\nconst withAliveScope = (WrappedComponent) => {\n  const renderContent = ({ helpers, props, forwardedRef }) => (\n    <WrappedComponent {...props} {...helpers} ref={forwardedRef} />\n  )\n\n  const HookScope = ({ forwardedRef, ...props }) =>\n    renderContent({\n      helpers: controllerCherryPick(useScopeContext() || {}),\n      props,\n      forwardedRef,\n    })\n\n  const WithScope = ({ forwardedRef, ...props }) => (\n    <AliveScopeConsumer>\n      {(controller = {}) =>\n        renderContent({\n          helpers: controllerCherryPick(controller),\n          props,\n          forwardedRef,\n        })\n      }\n    </AliveScopeConsumer>\n  )\n\n  const HOCWithAliveScope = isFunction(useContext) ? HookScope : WithScope\n\n  if (isFunction(forwardRef)) {\n    const ForwardedRefHOC = forwardRef((props, ref) => (\n      <HOCWithAliveScope {...props} forwardedRef={ref} />\n    ))\n\n    return hoistStatics(ForwardedRefHOC, WrappedComponent)\n  } else {\n    return hoistStatics(HOCWithAliveScope, WrappedComponent)\n  }\n}\n\nexport const useAliveController = () => {\n  if (!isFunction(useContext)) {\n    return {}\n  }\n\n  const ctxValue = useScopeContext()\n\n  if (!ctxValue) {\n    return {}\n  }\n\n  return controllerCherryPick(ctxValue)\n}\n\nexport default withAliveScope\n","import {\n  globalThis as root,\n  get,\n  run,\n  value,\n  isFunction,\n  isExist,\n  flatten,\n} from 'szfe-tools'\n\nfunction isScrollableNode(node = {}) {\n  if (!isExist(node)) {\n    return false\n  }\n\n  return (\n    node.scrollWidth > node.clientWidth || node.scrollHeight > node.clientHeight\n  )\n}\n\nfunction getScrollableNodes(from) {\n  if (!isFunction(get(root, 'document.querySelectorAll'))) {\n    return []\n  }\n\n  return [...value(run(from, 'querySelectorAll', '*'), []), from].filter(\n    isScrollableNode\n  )\n}\n\nexport default function saveScrollPosition(from) {\n  const nodes = [...new Set([...flatten(from.map(getScrollableNodes))])]\n\n  const saver = nodes.map((node) => [\n    node,\n    {\n      x: node.scrollLeft,\n      y: node.scrollTop,\n    },\n  ])\n\n  return function revert() {\n    saver.forEach(([node, { x, y }]) => {\n      node.scrollLeft = x\n      node.scrollTop = y\n    })\n  }\n}\n","import React, { Component } from 'react'\nimport {\n  value,\n  get,\n  run,\n  globalThis as root,\n  nextTick,\n  isFunction,\n  isArray,\n  debounce,\n  flatten,\n} from 'szfe-tools'\n\nimport { expandKeepAlive } from './withAliveScope'\nimport {\n  LIFECYCLE_ACTIVATE,\n  LIFECYCLE_UNACTIVATE,\n  withActivation,\n} from './lifecycles'\nimport saveScrollPosition from '../helpers/saveScrollPosition'\n\nconst body = get(root, 'document.body')\nconst screenScrollingElement = get(\n  root,\n  'document.scrollingElement',\n  get(root, 'document.documentElement', {})\n)\n\nconst parseWhenResult = (res) => {\n  if (isArray(res)) {\n    return res\n  }\n\n  return [res]\n}\n\nclass KeepAlive extends Component {\n  static defaultProps = {\n    saveScrollPosition: true,\n  }\n\n  id = null // 用作 Keeper 识别 KeepAlive\n  isKeepAlive = true // 用作 Keeper 识别 KeepAlive\n  cached = false\n  constructor(props) {\n    super(props)\n    this.id = props.id\n    this.init()\n\n    // 继承响应父级 KeepAlive 的生命周期\n    ;[LIFECYCLE_ACTIVATE, LIFECYCLE_UNACTIVATE].forEach((lifecycleName) => {\n      this[lifecycleName] = () => {\n        const { id, _helpers } = this.props\n        const cache = _helpers.getCache(id)\n        const node = _helpers.getNode(id)\n        if (node && lifecycleName === LIFECYCLE_ACTIVATE) {\n          node.updateTime = Date.now()\n        }\n\n        const cached = lifecycleName === LIFECYCLE_UNACTIVATE\n\n        // 若组件即将卸载则不再触发缓存生命周期\n        if (!cache || cache.willDrop) {\n          // 若组件在父 KeepAlive 缓存期间被卸载，后续恢复后需重新触发 init\n          if (this.cached && !cached) {\n            this.init()\n          }\n          return\n        }\n\n        run(cache, lifecycleName)\n        cache.cached = cached\n        this.cached = cached\n      }\n    })\n  }\n\n  // DOM 操作将实际内容插入占位元素\n  inject = (didActivate = true) => {\n    const { id, saveScrollPosition, _helpers } = this.props\n    const cache = _helpers.getCache(id)\n    // DOM 操作有风险，try catch 护体\n    try {\n      // // 原计划不增加额外的节点，直接将 Keeper 中所有内容节点一一迁移\n      // // 后发现缺乏统一 react 认可的外层包裹，可能会造成 react dom 操作的错误\n      // // 且将导致 KeepAlive 进行 update 时需先恢复各 dom 节点的组件归属，成本过高\n      // // 故此处增加统一的 div 外层，Keeper 中与 KeepAlive 中各一个且外层不做移除处理\n      // this.parentNode = this.placeholder.parentNode\n      // cache.nodes.forEach(node => {\n      //   this.parentNode.insertBefore(node, this.placeholder)\n      // })\n      // this.parentNode.removeChild(this.placeholder)\n      // 将 AliveScopeProvider 中的渲染内容通过 dom 操作置回当前 KeepAlive\n      cache.nodes.forEach((node) => {\n        this.placeholder.appendChild(node)\n      })\n\n      if (didActivate && saveScrollPosition) {\n        // 恢复该节点下各可滚动元素的滚动位置\n        run(cache.revertScrollPos)\n      }\n    } catch (error) {\n      // console.error(error)\n    }\n  }\n\n  // DOM 操作将实际内容移出占位元素\n  eject = (willUnactivate = true) => {\n    const { id, _helpers } = this.props\n    const cache = _helpers.getCache(id)\n    const nodesNeedToSaveScrollPosition = flatten(\n      flatten([this.props.saveScrollPosition]).map((flag) => {\n        if (flag === true) {\n          return cache.nodes\n        }\n\n        if (flag === 'screen') {\n          return [screenScrollingElement, body]\n        }\n\n        return [...value(run(root, 'document.querySelectorAll', flag), [])]\n      })\n    ).filter(Boolean)\n\n    // DOM 操作有风险，try catch 护体\n    try {\n      if (willUnactivate && nodesNeedToSaveScrollPosition.length > 0) {\n        // 保存该节点下各可滚动元素的滚动位置\n        cache.revertScrollPos = saveScrollPosition(\n          nodesNeedToSaveScrollPosition\n        )\n      }\n\n      // // 原计划不增加额外的节点，直接将 Keeper 中所有内容节点一一迁移\n      // // 后发现缺乏统一 react 认可的外层包裹，可能会造成 react dom 操作的错误\n      // // 且将导致 KeepAlive 进行 update 时需先恢复各 dom 节点的组件归属，成本过高\n      // // 故此处增加统一的 div 外层，Keeper 中与 KeepAlive 中各一个且外层不做移除处理\n      // this.parentNode.insertBefore(this.placeholder, cache.nodes[0])\n      // cache.nodes.forEach(node => {\n      //   if (willUnactivate) {\n      //     this.parentNode.removeChild(node)\n      //   } else {\n      //     cache.wrapper.appendChild(node)\n      //   }\n      // })\n      // this.parentNode.insertBefore(this.placeholder, cache.nodes[0])\n      // 将 KeepAlive 中的节点恢复为原先的占位节点，保证卸载操作正常进行\n      cache.nodes.forEach((node) => {\n        if (willUnactivate) {\n          this.placeholder.removeChild(node)\n        } else {\n          cache.wrapper.appendChild(node)\n        }\n      })\n    } catch (error) {\n      // console.error(error)\n    }\n  }\n\n  init = () => {\n    const { _helpers, id, children, ...rest } = this.props\n\n    // 将 children 渲染至 AliveScopeProvider 中\n    _helpers\n      .keep(id, {\n        children,\n        getInstance: () => this,\n        ...rest,\n      })\n      .then((cache) => {\n        // fix #22\n        if (!cache) {\n          return\n        }\n\n        this.inject()\n\n        // 触发 didActivate 生命周期\n        if (cache.inited) {\n          run(this, LIFECYCLE_ACTIVATE)\n        } else {\n          cache.inited = true\n        }\n        this.cached = false\n      })\n  }\n\n  update = ({ _helpers, id, name, ...rest } = {}) => {\n    if (!_helpers || this.cached) {\n      return\n    }\n\n    // // 原先打算更新过程中先重置 dom 节点状态，更新后恢复 dom 节点\n    // // 但考虑到性能消耗可能过大，且可能因 dom 操作时机引发其他 react 渲染问题，故不使用\n    // // 对应 Keeper 处 componentDidUpdate 也注释起来不使用\n    // this.eject(false)\n    _helpers.update(id, {\n      name,\n      getInstance: () => this,\n      ...rest,\n    })\n    // this.inject(false)\n  }\n\n  // 利用 shouldComponentUpdate 提前触发组件更新\n  shouldComponentUpdate(nextProps) {\n    this.update(nextProps)\n\n    return false\n  }\n\n  // 组件卸载时重置 dom 状态，保证 react dom 操作正常进行，并触发 unactivate 生命周期\n  componentWillUnmount() {\n    const { id, _helpers, when: calcWhen = true } = this.props\n    const cache = _helpers.getCache(id)\n    const [when, isScope] = parseWhenResult(run(calcWhen))\n\n    if (!cache) {\n      return\n    }\n\n    this.eject()\n    delete cache.getInstance\n\n    if (!when) {\n      if (isScope) {\n        const needToDrop = [\n          cache,\n          ..._helpers.getScopeIds([id]).map((id) => _helpers.getCache(id)),\n        ].filter(Boolean)\n\n        needToDrop.forEach((cache) => {\n          cache.willDrop = true\n        })\n        nextTick(() => _helpers.dropScopeByIds([id]))\n      } else {\n        cache.willDrop = true\n        nextTick(() => _helpers.dropById(id))\n      }\n    }\n\n    // 触发 willUnactivate 生命周期\n    run(this, LIFECYCLE_UNACTIVATE)\n  }\n\n  render() {\n    return (\n      <div\n        key=\"keep-alive-placeholder\"\n        nodeKeyIgnore\n        className=\"ka-wrapper\"\n        ref={(node) => {\n          this.placeholder = node\n        }}\n      />\n    )\n  }\n}\n\n// 兼容 SSR 服务端渲染\nfunction SSRKeepAlive({ children }) {\n  return (\n    <div key=\"keep-alive-placeholder\" nodeKeyIgnore className=\"ka-wrapper\">\n      <div key=\"keeper-container\" nodeKeyIgnore className=\"ka-content\">\n        {children}\n      </div>\n    </div>\n  )\n}\n\nexport default isFunction(get(root, 'document.getElementById'))\n  ? expandKeepAlive(withActivation(KeepAlive))\n  : SSRKeepAlive\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}