{"ast":null,"code":"import{useContext,useState}from\"react\";import{AuthContext}from\"./context/AuthProvider\";import axios from\"axios\";import AddImagesComponent from\"./AddImagesComponent\";import\"./styles/CommentForm.css\";import{Link}from\"react-router-dom\";import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const CommentFormComponent=props=>{var _auth$user;const{auth,setAuth}=useContext(AuthContext);const[commentText,setCommentText]=useState(\"\");const[commentImages,setCommentImages]=useState([]);const[dataSendStatus,setDataSendStatus]=useState(null);const[showedError,setShowedError]=useState(\"\");const max_images=3;function PostNewComment(event){const postData=async()=>{const formData=new FormData();formData.append(\"author\",auth[\"user\"][\"id\"]);formData.append(\"post\",props.post_id);formData.append(\"content\",commentText);commentImages.forEach((image,index)=>{formData.append(`image_${index}`,image.file);});try{const response=await axios.post(props.api_url+\"new_comment\",formData,{headers:{\"Content-Type\":\"multipart/form-data\"}});setCommentImages([]);setCommentText(\"\");}catch(error){console.error(\"Ошибка при отправке:\",error);setDataSendStatus(\"fail\");}};event.preventDefault();try{if(auth!==null&&auth!==void 0&&auth.user&&(commentText!=\"\"||commentImages.length!=0)){postData();}}catch(e){console.log(e);setDataSendStatus(\"fail\");}return 0;}if(auth!==null&&auth!==void 0&&(_auth$user=auth.user)!==null&&_auth$user!==void 0&&_auth$user.id){return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsxs(\"form\",{className:\"comment-form-box\",onSubmit:PostNewComment,children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"comment-content\",children:\"\\u041E\\u0441\\u0442\\u0430\\u0432\\u044C\\u0442\\u0435 \\u043A\\u043E\\u043C\\u043C\\u0435\\u043D\\u0442\\u0430\\u0440\\u0438\\u0439\"}),/*#__PURE__*/_jsx(\"textarea\",{type:\"text\",id:\"comment-box\",onChange:e=>{setCommentText(e.target.value);},placeholder:\"\\u041D\\u0430\\u043F\\u0438\\u0448\\u0438\\u0442\\u0435, \\u0447\\u0442\\u043E \\u0434\\u0443\\u043C\\u0430\\u0435\\u0442\\u0435\",value:commentText}),/*#__PURE__*/_jsx(AddImagesComponent,{max_images:max_images,images:commentImages,setImages:setCommentImages}),/*#__PURE__*/_jsx(\"button\",{children:\" \\u041E\\u0442\\u0432\\u0435\\u0442\\u0438\\u0442\\u044C \"}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"label\",{children:showedError})]})]});}else{return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsxs(\"label\",{children:[\" \",\"\\u0412\\u043E\\u0439\\u0434\\u0438\\u0442\\u0435 \\u0438\\u043B\\u0438 \\u0437\\u0430\\u0440\\u0435\\u0433\\u0438\\u0441\\u0442\\u0440\\u0438\\u0440\\u0443\\u0439\\u0442\\u0435\\u0441\\u044C, \\u0447\\u0442\\u043E\\u0431\\u044B \\u043E\\u0441\\u0442\\u0430\\u0432\\u043B\\u044F\\u0442\\u044C \\u043A\\u043E\\u043C\\u043C\\u0435\\u043D\\u0442\\u0430\\u0440\\u0438\\u0438.\",\" \"]}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(Link,{to:\"/login\",children:/*#__PURE__*/_jsx(\"button\",{children:\" \\u0412\\u043E\\u0439\\u0442\\u0438 \"})}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"br\",{})]});}};export default CommentFormComponent;","map":{"version":3,"names":["useContext","useState","AuthContext","axios","AddImagesComponent","Link","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","CommentFormComponent","props","_auth$user","auth","setAuth","commentText","setCommentText","commentImages","setCommentImages","dataSendStatus","setDataSendStatus","showedError","setShowedError","max_images","PostNewComment","event","postData","formData","FormData","append","post_id","forEach","image","index","file","response","post","api_url","headers","error","console","preventDefault","user","length","e","log","id","children","className","onSubmit","htmlFor","type","onChange","target","value","placeholder","images","setImages","to"],"sources":["/media/starrynight/main_pt/projects_linux/blog_website/frontend/blog-website/src/CommentFormComponent.js"],"sourcesContent":["import { useContext, useState } from \"react\";\nimport { AuthContext } from \"./context/AuthProvider\";\nimport axios from \"axios\";\nimport AddImagesComponent from \"./AddImagesComponent\";\nimport \"./styles/CommentForm.css\";\nimport { Link } from \"react-router-dom\";\n\nconst CommentFormComponent = (props) => {\n  const { auth, setAuth } = useContext(AuthContext);\n  const [commentText, setCommentText] = useState(\"\");\n  const [commentImages, setCommentImages] = useState([]);\n  const [dataSendStatus, setDataSendStatus] = useState(null);\n  const [showedError, setShowedError] = useState(\"\");\n\n  const max_images = 3;\n\n  function PostNewComment(event) {\n    const postData = async () => {\n      const formData = new FormData();\n\n      formData.append(\"author\", auth[\"user\"][\"id\"]);\n      formData.append(\"post\", props.post_id);\n      formData.append(\"content\", commentText);\n\n      commentImages.forEach((image, index) => {\n        formData.append(`image_${index}`, image.file);\n      });\n\n      try {\n        const response = await axios.post(\n          props.api_url + \"new_comment\",\n          formData,\n          {\n            headers: {\n              \"Content-Type\": \"multipart/form-data\",\n            },\n          }\n        );\n        setCommentImages([]);\n        setCommentText(\"\");\n      } catch (error) {\n        console.error(\"Ошибка при отправке:\", error);\n        setDataSendStatus(\"fail\");\n      }\n    };\n    event.preventDefault();\n    try {\n      if (auth?.user && (commentText != \"\" || commentImages.length != 0)) {\n        postData();\n      }\n    } catch (e) {\n      console.log(e);\n      setDataSendStatus(\"fail\");\n    }\n    return 0;\n  }\n  if (auth?.user?.id) {\n    return (\n      <>\n        <br />\n        <br />\n        <form className=\"comment-form-box\" onSubmit={PostNewComment}>\n          <label htmlFor=\"comment-content\">Оставьте комментарий</label>\n          <textarea\n            type=\"text\"\n            id=\"comment-box\"\n            onChange={(e) => {\n              setCommentText(e.target.value);\n            }}\n            placeholder=\"Напишите, что думаете\"\n            value={commentText}\n          ></textarea>\n          <AddImagesComponent\n            max_images={max_images}\n            images={commentImages}\n            setImages={setCommentImages}\n          ></AddImagesComponent>\n          <button> Ответить </button>\n          <br />\n          <label>{showedError}</label>\n        </form>\n      </>\n    );\n  } else {\n    return (\n      <>\n        <br />\n        <br />\n        <label>\n          {\" \"}\n          Войдите или зарегистрируйтесь, чтобы оставлять комментарии.{\" \"}\n        </label>\n        <br />\n        <br />\n        <Link to=\"/login\">\n          <button> Войти </button>\n        </Link>\n        <br />\n        <br />\n        <br />\n        <br />\n        <br />\n      </>\n    );\n  }\n};\n\nexport default CommentFormComponent;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}